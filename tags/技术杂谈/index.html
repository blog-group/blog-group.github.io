<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>标签: 技术杂谈 - 程序员恒宇少年 | SpringBoot | SpringCloud | Java - 个人博客</title>


    <meta name="description" content="记录程序员恒宇少年 - 于起宇工作日常遇到的问题，针对技术点提供文章导读，源码分析，主要提供Java、Spring、SpringBoot、SpringCloud等相关知识，提供有关恒宇少年,ApiBoot,apiboot,springboot,spring,SpringBoot,springcloud,SpringCloud,微服务,框架使用,技术文章技术文章">
<meta name="keywords" content="恒宇少年,于起宇,ApiBoot,SpringBoot,SpringCloud,微服务">
<meta property="og:type" content="website">
<meta property="og:title" content="程序员恒宇少年 | SpringBoot | SpringCloud | Java - 个人博客">
<meta property="og:url" content="https://blog.minbox.org/tags/技术杂谈/index.html">
<meta property="og:site_name" content="程序员恒宇少年 | SpringBoot | SpringCloud | Java - 个人博客">
<meta property="og:description" content="记录程序员恒宇少年 - 于起宇工作日常遇到的问题，针对技术点提供文章导读，源码分析，主要提供Java、Spring、SpringBoot、SpringCloud等相关知识，提供有关恒宇少年,ApiBoot,apiboot,springboot,spring,SpringBoot,springcloud,SpringCloud,微服务,框架使用,技术文章技术文章">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://blog.minbox.org/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="程序员恒宇少年 | SpringBoot | SpringCloud | Java - 个人博客">
<meta name="twitter:description" content="记录程序员恒宇少年 - 于起宇工作日常遇到的问题，针对技术点提供文章导读，源码分析，主要提供Java、Spring、SpringBoot、SpringCloud等相关知识，提供有关恒宇少年,ApiBoot,apiboot,springboot,spring,SpringBoot,springcloud,SpringCloud,微服务,框架使用,技术文章技术文章">
<meta name="twitter:image" content="https://blog.minbox.org/images/og_image.png">







<link rel="icon" href="/images/favicon.jpg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="/css/font-awesome-5.4.1-all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/ocean.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-127746557-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-127746557-1');
</script>


    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    
        <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-2-column">
    <nav class="navbar navbar-main">
  <div class="container">
    <div class="navbar-brand is-flex-center">
      <a class="navbar-item navbar-logo" href="/">
        <div class="logo"></div>
        <span class="site_title">恒宇少年 - 于起宇</span>
      </a>
    </div>
    <div class="navbar-menu">
      
      <div class="navbar-start nav-link">
        
        <a class="navbar-item"
          href="/interview-strategy.html" target="_blank">面试攻略</a>
        
        <a class="navbar-item"
          href="/welfare/" target="_blank">签到送书</a>
        
        <a class="navbar-item"
          href="/geektime/" target="_blank">推荐课程</a>
        
        <a class="navbar-item"
          href="/opensource/" target="_blank">我的开源</a>
        
        <a class="navbar-item"
          href="/openbooks/" target="_blank">免费书籍</a>
        
        <a class="navbar-item"
          href="/years/2019.html" target="_blank">我的2019</a>
        
        <a class="navbar-item"
          href="/archives/" target="_blank">归档</a>
        
      </div>
      
      <div class="navbar-end">
        
        
        
        <a class="navbar-item search" title="搜索" href="javascript:;">
          <i class="fas fa-search"></i>
        </a>
        
      </div>
    </div>
  </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-9-desktop is-9-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/tags">标签</a></li>
            <li class="is-active"><a href="#" aria-current="page">技术杂谈</a></li>
        </ul>
        </nav>
    </div>
</div>
<!--文章列表-->

    
<div id="container">
  
  <div class="card" style="margin-bottom: 10px">
    
    <div class="card-content article ">
      <!--文章标题-->
      
      <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
        
        <a class="has-link-black-ter" href="/git-chapter-core-directory.html">Git托管项目的.git目录下都有什么？</a>
        
      </h1>
      <!--完全自定义页面显示的访问次数-->
      
      
      <div class="level article-meta is-mobile is-overflow-x-auto" style="font-size: 15px">
        <div class="level-left">
          <!--文章类型-->
          
          
          
          <span
            style="float: left;padding: 1px 2px 1px 2px;margin-right: 5px;background-color: #5cb85c;color: white;text-align: center;border-radius:0.25em;font-size: 14px">
            原创</span>
          
          
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--发布时间-->
          <img src="/images/date_time.png" style="width: 25px;" title="发布时间"/>
          &nbsp;
          <span class="article-meta-element">2022-05-29</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--作者-->
          <img src="/images/author.svg" style="width: 23px" title="文章作者"/>

          <span class="article-meta-element">于起宇</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--目录列表-->
          
          <img src="/images/categories.svg" style="width: 20px;" title="文章所属目录列表"/>
          &nbsp;
          <div class="level-item article-meta-element">
            <!--读取config.yml文件内的目录配置-->
            
            
              
                
              
                
              
                
              
                
                  <!--跳转文章目录地址-->
                  <a class="category-link" href="/technical-talk.html">技术杂谈</a>&nbsp;
                
              
            
          </div>
          
          <!--不蒜子统计阅读量-->
          <!---->
        </div>
      </div>
      
      
      <!--推荐阅读 - 新闻-->
      
      <!--文章内容-->
      <div class="content">
        <p>我们在使用<code>git</code>托管项目代码时，如果是新建项目需要通过<code>git init</code>命令在项目根目录下初始化<code>.git</code>目录来实现后续的代码托管管理，如果直接从代码仓库拉取代码则会自动创建<code>.git</code>目录与远程仓库进行绑定。</p>
<h2 id="git目录结构"><a href="#git目录结构" class="headerlink" title=".git目录结构"></a>.git目录结构</h2><p>首先我们先来看看<code>.git</code>这个目录的结构是什么样子的，如下所示：</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">⋊&gt; ~/s/g/.git on master ⨯ <span class="hljs-built_in">pwd</span>                                                                                                                                                                                                                                                                          10:24:08</span><br><span class="line">/Users/yuqiyu/study/git-chapter/.git</span><br><span class="line">⋊&gt; ~/s/g/.git on master ⨯ ll                                                                                                                                                                                                                                                                           10:24:09</span><br><span class="line">total 64</span><br><span class="line">-rw-r--r--    1 yuqiyu  staff    16B May 26 13:51 COMMIT_EDITMSG</span><br><span class="line">-rw-r--r--    1 yuqiyu  staff    91B May 27 11:20 FETCH_HEAD</span><br><span class="line">-rw-r--r--    1 yuqiyu  staff    23B May 26 13:33 HEAD</span><br><span class="line">-rw-r--r--    1 yuqiyu  staff    41B May 26 13:50 ORIG_HEAD</span><br><span class="line">drwxr-xr-x    2 yuqiyu  staff    64B May 19 09:07 branches/</span><br><span class="line">-rw-r--r--    1 yuqiyu  staff   361B May 29 09:31 config</span><br><span class="line">-rw-r--r--    1 yuqiyu  staff    73B May 19 09:07 description</span><br><span class="line">drwxr-xr-x   13 yuqiyu  staff   416B May 19 09:07 hooks/</span><br><span class="line">-rw-r--r--    1 yuqiyu  staff   751B May 26 13:51 index</span><br><span class="line">drwxr-xr-x    3 yuqiyu  staff    96B May 19 09:07 info/</span><br><span class="line">drwxr-xr-x    4 yuqiyu  staff   128B May 19 09:08 logs/</span><br><span class="line">drwxr-xr-x  127 yuqiyu  staff   4.0K May 27 11:20 objects/</span><br><span class="line">drwxr-xr-x    6 yuqiyu  staff   192B May 25 16:17 refs/</span><br><span class="line">-rw-r--r--@   1 yuqiyu  staff   174B May 27 11:20 sourcetreeconfig</span><br><span class="line">⋊&gt; ~/s/g/.git on master ⨯</span><br></pre></td></tr></table></figure>

<h3 id="HEAD文件"><a href="#HEAD文件" class="headerlink" title="HEAD文件"></a>HEAD文件</h3><p><code>HEAD</code>是当前活动分支的游标指向，我们可以查看下该文件的内容：</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">⋊&gt; ~/s/g/.git on master ⨯ cat HEAD                                                                                                                                                                                                                                                                     11:17:22</span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>

<p>可以看到<code>HEAD</code>文件目前指向<code>master</code>分支，而<code>master</code>分支则位于<code>refs/heads</code>目录下，我们接下来可以去<code>refs</code>目录下看看都有哪些内容。</p>
<h3 id="refs目录"><a href="#refs目录" class="headerlink" title="refs目录"></a>refs目录</h3><p><code>refs</code>目录存储了一些引用指向，我们在使用<code>branch</code>、<code>tag</code>时大多数都是引用到该目录下，然后再指向具体的<code>objects</code>。</p>
<p><code>refs</code>目录结构如下所示：</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">⋊&gt; ~/s/g/.g/refs on master ⨯ <span class="hljs-built_in">pwd</span>                                                                                                                                                                                                                                                                       11:26:27</span><br><span class="line">/Users/yuqiyu/study/git-chapter/.git/refs</span><br><span class="line">⋊&gt; ~/s/g/.g/refs on master ⨯ ll                                                                                                                                                                                                                                                                        11:26:28</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 yuqiyu  staff    96B May 26 13:51 heads/</span><br><span class="line">drwxr-xr-x  3 yuqiyu  staff    96B May 25 16:17 remotes/</span><br><span class="line">-rw-r--r--  1 yuqiyu  staff    41B May 19 10:12 stash</span><br><span class="line">drwxr-xr-x  3 yuqiyu  staff    96B May 29 09:36 tags/</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>refs</code>内全部目录的文件都是存储的<code>objects</code>引用，我们下面以<code>heads</code>目录为例</p>
</blockquote>
<h4 id="heads"><a href="#heads" class="headerlink" title="heads"></a>heads</h4><p>该目录下存放该项目在本地全部的分支，每个分支文件存储了<code>commit id</code>，如下所示：</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">⋊&gt; ~/s/g/.g/refs on master ⨯ <span class="hljs-built_in">cd</span> heads/                                                                                                                                                                                                                                                                 09:01:37</span><br><span class="line">⋊&gt; ~/s/g/.g/r/heads on master ⨯ ls                                                                                                                                                                                                                                                                     09:03:13</span><br><span class="line">master</span><br><span class="line">⋊&gt; ~/s/g/.g/r/heads on master ⨯ cat master                                                                                                                                                                                                                                                             09:03:13</span><br><span class="line">33248b733e36a495ea3691f2d1291c5e77633229</span><br></pre></td></tr></table></figure>

<p>通过<code>cat master</code>命令我们可以查看该文件的内容，发现该文件的内容是一长串的字符编号，如果想要知道这个一长串字符编号是什么我们可以通过<code>git cat-file</code>命令来查看类型以及详细内容，如下所示：</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># -t 参数查看文件的类型</span></span><br><span class="line">⋊&gt; ~/s/g/.g/r/heads on master ⨯ git cat-file -t 33248b733e36a495ea3691f2d1291c5e77633229                                                                                                                                                                                                               09:32:11</span><br><span class="line">commit</span><br><span class="line"><span class="hljs-comment"># -p 参数查看该文件的详细内容</span></span><br><span class="line">⋊&gt; ~/s/g/.g/r/heads on master ⨯ git cat-file -p 33248b733e36a495ea3691f2d1291c5e77633229                                                                                                                                                                                                               09:59:48</span><br><span class="line">tree 026567e8fe35ef942c1ea7f833799f26027d964f</span><br><span class="line">parent d78e592e663b2a34da826810303bd75f671a84af</span><br><span class="line">author 恒宇少年 &lt;39233436+hengboy@users.noreply.github.com&gt; 1653544281 +0800</span><br><span class="line">committer 恒宇少年 &lt;39233436+hengboy@users.noreply.github.com&gt; 1653544281 +0800</span><br><span class="line"></span><br><span class="line">添加默认值</span><br></pre></td></tr></table></figure>

<p>通过<code>git cat-file -t</code>命令我们发现<code>33248b733e36a495ea3691f2d1291c5e77633229</code>文件是一个<code>commit</code>类型的<code>objects</code>，通过<code>git cat-file -p</code>命令就可以查看该文件的详细内容了。</p>
<p>我们从文件内容来看可以猜测出该文件应该是对应的<code>master</code>分支的最后一次提交的<code>commit</code>，我们可以通过<code>git branch -av</code>命令来查看每个分支的情况，如下所示：</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">⋊&gt; ~/s/g/.g/r/heads on master ⨯ git branch -av                                                                                                                                                                                                                                                         09:07:59</span><br><span class="line">* master                33248b7 添加默认值</span><br><span class="line">  remotes/origin/master 33248b7 添加默认值</span><br></pre></td></tr></table></figure>

<p>发现本地<code>master</code>分支指向了<code>33248b7</code>，也就是我们刚才<code>cat master</code>内容<code>33248b733e36a495ea3691f2d1291c5e77633229</code>的缩写，这样我们就明白了，<code>master</code>文件内存储了最新提交的指向。</p>
<h4 id="tags"><a href="#tags" class="headerlink" title="tags"></a>tags</h4><p>该目录下存储了全部的tag文件，每个tag文件也是存储了<code>objects</code>指向，一般<code>tag</code>是基于<code>commit</code>来打的所以指向跟<code>commit</code>一致。</p>
<p>我们项目中有个<code>temp</code>的<code>tag</code>，我们可以查看下该文件的类型以及内容：</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">⋊&gt; ~/s/g/.g/refs on master ⨯ <span class="hljs-built_in">cd</span> tags/                                                                                                                                                                                                                                                                  10:13:42</span><br><span class="line">⋊&gt; ~/s/g/.g/r/tags on master ⨯ ls                                                                                                                                                                                                                                                                      10:13:43</span><br><span class="line">temp</span><br><span class="line">⋊&gt; ~/s/g/.g/r/tags on master ⨯ cat temp                                                                                                                                                                                                                                                                10:13:44</span><br><span class="line">33248b733e36a495ea3691f2d1291c5e77633229</span><br><span class="line">⋊&gt; ~/s/g/.g/r/tags on master ⨯ git cat-file -t 33248b733e36a495ea3691f2d1291c5e77633229                                                                                                                                                                                                                10:13:46</span><br><span class="line">commit</span><br></pre></td></tr></table></figure>

<p>我们发现<code>temp</code>分支文件内存储的指向也是<code>33248b733e36a495ea3691f2d1291c5e77633229</code>，<code>temp</code>标签是基于<code>master</code>分支最新<code>commit</code>打的，所以<code>tag</code>的<code>objects</code>指向与<code>master</code>分支的指向是一致的。</p>
<h3 id="config文件"><a href="#config文件" class="headerlink" title="config文件"></a>config文件</h3><p>在<code>.git</code>目录下有个<code>config</code>文件，存放了该仓库的配置信息，内容如下：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[core]</span><br><span class="line">        repositoryformatversion = 0</span><br><span class="line">        filemode = true</span><br><span class="line">        bare = false</span><br><span class="line">        logallrefupdates = true</span><br><span class="line">        ignorecase = true</span><br><span class="line">        precomposeunicode = true</span><br><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">        url = git@gitee.com:hengboy/git-chapter.git</span><br><span class="line">        fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">[branch &quot;master&quot;]</span><br><span class="line">        remote = origin</span><br><span class="line">        merge = refs/heads/master</span><br></pre></td></tr></table></figure>

<p>该文件内定义了一些核心参数配置、远程分支信息、本地分支列表等，我们通过<code>git config  --local</code> 也可以为该仓库配置参数，如下所示：</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --<span class="hljs-built_in">local</span> user.name <span class="hljs-string">'恒宇少年'</span></span><br><span class="line">git config --<span class="hljs-built_in">local</span> user.email <span class="hljs-string">'jnyuqy@gmail.com'</span></span><br></pre></td></tr></table></figure>

<p>通过上面命令配置后再<code>.git/config</code>文件内就会添加对应的配置内容：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[user]</span><br><span class="line">        name = 恒宇少年</span><br><span class="line">        email = jnyuqy@gmail.com</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><code>git</code>远比我们想的强大，本文章是一个入门篇，应对工作中遇到的各种问题后续针对<code>git</code>还回详谈，熟练的运用<code>git</code>让我们在协同开发过程中不再有<strong>冲突恐惧症</strong>。</p>

        
        <!--原创-->
        
        <!--转载标注-->
        
        
      </div>
      <!--文章标签-->
      
      
      
    </div>
  </div>

  
  

  
  <!--评论-->
  
  
</div>

<script src="/js/readmore.js" type="text/javascript"></script>
<script>
  const btw = new BTWPlugin();
  btw.init({
    id: 'container',
    blogId: '10034-1569731208928-426',
    name: '恒宇少年',
    qrcode: 'https://blog.yuqiyu.com/images/mp.jpg',
    keyword: 'free',
  });
</script>

<!--<script src="/js/layui.js"></script>
<script>
  layui.use(['layer'], function () {
    var layer = layui.layer;
    var isShowOnce = localStorage.getItem('isShowHistory');
    if (!isShowOnce) {
      localStorage.setItem('isShowHistory',true);
      layer.open({
          type: 1
          ,title: false //不显示标题栏
          ,closeBtn: false
          ,area: '350px;'
          ,shade: 0.8
          ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
          ,btn: ['带朕去看看', '给朕退下']
          ,btnAlign: 'c'
          ,moveType: 1 //拖拽模式，0或者1
          ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-size:13px; font-weight: 300;">你知道吗？阿里云的采购季来了！！！<br/><br/>云产品低至<b>0.75折</b> </br></br>ECS服务器最低 <b>¥74.43</b>/年 ...<br><br>MySQL云数据库最低 <b>¥188</b>/年 ...<br><br>1.5万条的短信只需要 <b>¥540</b> <br/><br/>500G的CDN流量包更是优惠到极致了...</div>'
          ,success: function(layero){
            var btn = layero.find('.layui-layer-btn');
            btn.find('.layui-layer-btn0').attr({
              href: 'https://www.aliyun.com/minisite/goods?userCode=rqxni4zt&share_source=copy_link'
              ,target: '_blank'
            });
          }
        });
    }
  });
</script>-->


    
<div id="container">
  
  <div class="card" style="margin-bottom: 10px">
    
    <div class="card-content article ">
      <!--文章标题-->
      
      <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
        
        <a class="has-link-black-ter" href="/fish-fast-switch-jdk.html">MacOS系统fish终端快速切换JDK版本</a>
        
      </h1>
      <!--完全自定义页面显示的访问次数-->
      
      
      <div class="level article-meta is-mobile is-overflow-x-auto" style="font-size: 15px">
        <div class="level-left">
          <!--文章类型-->
          
          
          
          <span
            style="float: left;padding: 1px 2px 1px 2px;margin-right: 5px;background-color: #5cb85c;color: white;text-align: center;border-radius:0.25em;font-size: 14px">
            原创</span>
          
          
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--发布时间-->
          <img src="/images/date_time.png" style="width: 25px;" title="发布时间"/>
          &nbsp;
          <span class="article-meta-element">2021-12-28</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--作者-->
          <img src="/images/author.svg" style="width: 23px" title="文章作者"/>

          <span class="article-meta-element">于起宇</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--目录列表-->
          
          <img src="/images/categories.svg" style="width: 20px;" title="文章所属目录列表"/>
          &nbsp;
          <div class="level-item article-meta-element">
            <!--读取config.yml文件内的目录配置-->
            
            
              
                
              
                
              
                
              
                
                  <!--跳转文章目录地址-->
                  <a class="category-link" href="/technical-talk.html">技术杂谈</a>&nbsp;
                
              
            
          </div>
          
          <!--不蒜子统计阅读量-->
          <!---->
        </div>
      </div>
      
      
      <!--推荐阅读 - 新闻-->
      
      <!--文章内容-->
      <div class="content">
        <p>倘若装有多个版本，特别是从 8 跨到 9 这个分界线，如果是基于 IDE，那么一般使用 IDE 提供的 JDK 设置来指定就可以了。<br>但如果是直接命令执行，那就需要来个方便切换版本的方法。</p>
<p>对于 MacOS，只需要设定 <code>JAVA_HOME</code> 这个环境变量就可以了，甚至不必要把这个路径添加到 <code>PATH</code> 中。</p>
<p>同时，在 MacOS 中，JAVA 相关有个好用的内置工具：<code>/usr/libexec/java_home</code></p>
<figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yuqiyu@hengyu ~&gt; /usr/libexec/java_home -h</span><br><span class="line">Usage: java_home [options...]</span><br><span class="line">    Returns the path to a Java home directory from the current user's settings.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    [-v/--version   &lt;version&gt;]       Filter versions (as if JAVA_VERSION had been set in the environment).</span><br><span class="line">    [-a/--arch      &lt;architecture&gt;]  Filter architecture (as if JAVA_ARCH had been set in the environment).</span><br><span class="line">    [-F/--failfast]                  Fail when filters return no JVMs, do not continue with default.</span><br><span class="line">    [   --exec      &lt;command&gt; ...]   Execute the $JAVA_HOME/bin/&lt;command&gt; with the remaining arguments.</span><br><span class="line">    [-X/--xml]                       Print full JVM list and additional data as XML plist.</span><br><span class="line">    [-V/--verbose]                   Print full JVM list with architectures.</span><br><span class="line">    [-h/--help]                      This usage information.</span><br></pre></td></tr></table></figure>

<p>所以，通过 <code>/usr/libexec/java_home -v 1.8</code> 这样的形式即可把 JDK 切到指定版本。</p>
<blockquote>
<p>这里是 8，当然，需要先安装对应的版本</p>
</blockquote>
<h3 id="查看可以切换的JDK列表"><a href="#查看可以切换的JDK列表" class="headerlink" title="查看可以切换的JDK列表"></a>查看可以切换的JDK列表</h3><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yuqiyu@hengyu ~&gt; /usr/libexec/java_home -V</span><br><span class="line">Matching Java Virtual Machines (4):</span><br><span class="line">    17.0.1 (x86_64) "Oracle Corporation" - "OpenJDK 17.0.1" /Users/yuqiyu/Library/Java/JavaVirtualMachines/openjdk-17.0.1/Contents/Home</span><br><span class="line">    11.0.8 (x86_64) "Oracle Corporation" - "Java SE 11.0.8" /Library/Java/JavaVirtualMachines/jdk-11.0.8.jdk/Contents/Home</span><br><span class="line">    1.8.0_312 (x86_64) "Amazon" - "Amazon Corretto 8" /Users/yuqiyu/Library/Java/JavaVirtualMachines/corretto-1.8.0_312/Contents/Home</span><br><span class="line">    1.8.0_231 (x86_64) "Oracle Corporation" - "Java SE 8" /Library/Java/JavaVirtualMachines/jdk1.8.0_231.jdk/Contents/Home</span><br><span class="line">/Users/yuqiyu/Library/Java/JavaVirtualMachines/openjdk-17.0.1/Contents/Home</span><br></pre></td></tr></table></figure>

<h3 id="创建切换JDK的fish函数"><a href="#创建切换JDK的fish函数" class="headerlink" title="创建切换JDK的fish函数"></a>创建切换JDK的fish函数</h3><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function setjdk</span><br><span class="line">    set -g -x JAVA_HOME (/usr/libexec/java_home -v $argv)</span><br><span class="line">    echo (java -version)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>在 <code>~/.config/fish/functions/</code> 下添加一个 <code>setjdk.fish</code>，填写以下内容，那么就可以在终端中使用 setjdk 1.8 / setjdk 9 的形式来切换到 JDK8 和 JDK9 了。</p>
<p><strong>切换效果：</strong></p>
<figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yuqiyu@hengyu ~&gt; java -version</span><br><span class="line">openjdk version "17.0.1" 2021-10-19</span><br><span class="line">OpenJDK Runtime Environment (build 17.0.1+12-39)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 17.0.1+12-39, mixed mode, sharing)</span><br><span class="line"></span><br><span class="line">yuqiyu@hengyu ~&gt; setjdk 1.8</span><br><span class="line">openjdk version "1.8.0_312"</span><br><span class="line">OpenJDK Runtime Environment Corretto-8.312.07.1 (build 1.8.0_312-b07)</span><br><span class="line">OpenJDK 64-Bit Server VM Corretto-8.312.07.1 (build 25.312-b07, mixed mode)</span><br><span class="line"></span><br><span class="line">yuqiyu@hengyu ~&gt; setjdk 11</span><br><span class="line">java version "11.0.8" 2020-07-14 LTS</span><br><span class="line">Java(TM) SE Runtime Environment 18.9 (build 11.0.8+10-LTS)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.8+10-LTS, mixed mode)</span><br></pre></td></tr></table></figure>
        
        <!--原创-->
        
        <!--转载标注-->
        
        
      </div>
      <!--文章标签-->
      
      
      
    </div>
  </div>

  
  

  
  <!--评论-->
  
  
</div>

<script src="/js/readmore.js" type="text/javascript"></script>
<script>
  const btw = new BTWPlugin();
  btw.init({
    id: 'container',
    blogId: '10034-1569731208928-426',
    name: '恒宇少年',
    qrcode: 'https://blog.yuqiyu.com/images/mp.jpg',
    keyword: 'free',
  });
</script>

<!--<script src="/js/layui.js"></script>
<script>
  layui.use(['layer'], function () {
    var layer = layui.layer;
    var isShowOnce = localStorage.getItem('isShowHistory');
    if (!isShowOnce) {
      localStorage.setItem('isShowHistory',true);
      layer.open({
          type: 1
          ,title: false //不显示标题栏
          ,closeBtn: false
          ,area: '350px;'
          ,shade: 0.8
          ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
          ,btn: ['带朕去看看', '给朕退下']
          ,btnAlign: 'c'
          ,moveType: 1 //拖拽模式，0或者1
          ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-size:13px; font-weight: 300;">你知道吗？阿里云的采购季来了！！！<br/><br/>云产品低至<b>0.75折</b> </br></br>ECS服务器最低 <b>¥74.43</b>/年 ...<br><br>MySQL云数据库最低 <b>¥188</b>/年 ...<br><br>1.5万条的短信只需要 <b>¥540</b> <br/><br/>500G的CDN流量包更是优惠到极致了...</div>'
          ,success: function(layero){
            var btn = layero.find('.layui-layer-btn');
            btn.find('.layui-layer-btn0').attr({
              href: 'https://www.aliyun.com/minisite/goods?userCode=rqxni4zt&share_source=copy_link'
              ,target: '_blank'
            });
          }
        });
    }
  });
</script>-->


    
<div id="container">
  
  <div class="card" style="margin-bottom: 10px">
    
    <div class="card-content article ">
      <!--文章标题-->
      
      <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
        
        <a class="has-link-black-ter" href="/postgresql-vs-mysql.html">PostgreSQL和MySQL到底选哪一个？</a>
        
      </h1>
      <!--完全自定义页面显示的访问次数-->
      
      
      <div class="level article-meta is-mobile is-overflow-x-auto" style="font-size: 15px">
        <div class="level-left">
          <!--文章类型-->
          
          
          <span
            style="float: left;padding: 1px 2px 1px 2px;margin-right: 5px;background-color: #a9800a;color: white;text-align: center;border-radius:0.25em;font-size: 14px">
            转载</span>
          
          
          
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--发布时间-->
          <img src="/images/date_time.png" style="width: 25px;" title="发布时间"/>
          &nbsp;
          <span class="article-meta-element">2021-11-19</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--作者-->
          <img src="/images/author.svg" style="width: 23px" title="文章作者"/>

          <span class="article-meta-element">nimapinfotech</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--目录列表-->
          
          <img src="/images/categories.svg" style="width: 20px;" title="文章所属目录列表"/>
          &nbsp;
          <div class="level-item article-meta-element">
            <!--读取config.yml文件内的目录配置-->
            
            
              
                
              
                
              
                
              
                
                  <!--跳转文章目录地址-->
                  <a class="category-link" href="/technical-talk.html">技术杂谈</a>&nbsp;
                
              
            
          </div>
          
          <!--不蒜子统计阅读量-->
          <!---->
        </div>
      </div>
      
      
      <!--推荐阅读 - 新闻-->
      
      <!--文章内容-->
      <div class="content">
        <p><img src="/images/post/postgresql-vs-mysql.png" alt></p>
<h2 id="PostgreSQL-VS-MySQL"><a href="#PostgreSQL-VS-MySQL" class="headerlink" title="PostgreSQL VS MySQL"></a>PostgreSQL VS MySQL</h2><table>
<thead>
<tr>
<th>VS</th>
<th>PostgreSQL</th>
<th>MySQL</th>
</tr>
</thead>
<tbody><tr>
<td>开源</td>
<td>PostgreSQL是一个免费的开源系统，它受PostgreSQL许可证（自由的开源许可证）的约束。</td>
<td>MySQL属于Oracle旗下产品，并提供几种付费版本供用户使用</td>
</tr>
<tr>
<td>管理</td>
<td>PostgreSQL是全球用户共同发展的产品</td>
<td>MySQL是GNU通用公共许可以及各种专有协议条款下的产品</td>
</tr>
<tr>
<td>性能</td>
<td>PostgreSQL适合对读写速度要求很高的大型系统中使用</td>
<td>MySQL主要用于Web应用程序，该Web应用程序仅需要数据库来进行数据交易。</td>
</tr>
<tr>
<td>遵循ACID</td>
<td>PostgreSQL从头到尾都遵循ACID原则，并确保满足需求</td>
<td>MySQL只有在使用InnoDB和NDB集群存储引擎时才符合ACID要求。</td>
</tr>
<tr>
<td>SQL 兼容性</td>
<td>“从文档看，PostgreSQL是兼容大部分SQL的。 PostgreSQL支持SQL:2011的大多数功能。在核心一致性所需的179个强制性功能中，PostgreSQL至少兼容160个。此外，还有一系列受支持的可选功能。”</td>
<td>“从文档看，MySQL在某些版本是兼容部分SQL。 我们对该产品的主要目标之一是继续努力达到SQL标准的要求，但又不牺牲速度或可靠性。我们可以添加SQL扩展或对非SQL功能的支持，如果这样可以极大地提高MySQL服务器在我们大部分用户群中的可用性。”</td>
</tr>
<tr>
<td>支持平台</td>
<td>PostgreSQL可以运行在Linux, Windows (Win2000 SP4 及以上)，FreeBSD，OpenBSD，NetBSD , Mac OS X, AIX, IRIX ,Solaris和 Tu64. 也支持由技术巨头惠普开发的HP-UX OS，以及开源的Unix OS。</td>
<td>MySQL可以运行在Oracle Solaris，Microsoft Windows, Linux Mac OS X。MySQL扩展了对开源FreeBSD OS的支持</td>
</tr>
<tr>
<td>编程语言支持</td>
<td>PostgreSQL是用C语言编写的，它支持多种编程语言，最突出的C/C++, Delphi, JavaScript, Java, Python, R , Tcl , Go, Lisp, Erlang和.Net.</td>
<td>PostgreSQL是用C和C++编写的，它支持C/C++, Erlang，PHP，Lisp,和Go, Perl，Java, Delphi, R ,和 Node.js.</td>
</tr>
<tr>
<td>物化视图</td>
<td>PostgreSQL支持物化视图</td>
<td>MySQL不支持物化视图</td>
</tr>
<tr>
<td>数据备份</td>
<td>PostgreSQL支持主备复制，并且还可以通过实现第三方扩展来处理其他类型的复制</td>
<td>MySQL支持主备复制，其中每个节点都是主节点，并且有权更新数据</td>
</tr>
<tr>
<td>可拓展性</td>
<td>PostgreSQL是高度可扩展的，您可以添加和拥有数据类型，运算符，索引类型和功能语言。</td>
<td>MySQL不支持拓展性。</td>
</tr>
<tr>
<td>访问方法</td>
<td>PostgreSQL支持所有标准。</td>
<td>MySQL支持所有标准。</td>
</tr>
<tr>
<td>社区支持</td>
<td>PostgreSQL有一个活跃的社区支持，该社区帮助改善现有功能，其富有创造力的提交者竭尽全力确保该数据库保持最新的功能和最大的安全性，成为最先进的数据库。</td>
<td>MySQL也有一个庞大的追随者社区，这些社区贡献者，特别是在被Oracle收购之后，主要关注一些偶尔出现的新功能，并维护现有功能。</td>
</tr>
<tr>
<td>安全性</td>
<td>PostgreSQL为连接提供本机SSL支持，以加密客户端/服务器通信。 PSQL还具有行级安全性。</td>
<td>MySQL是高度安全的，并且包含多个安全功能。</td>
</tr>
</tbody></table>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文中，我们讨论了两种最广泛使用的关系型数据库管理系统 PostgreSQL和MySQL的最先进的特性。这两种数据库管理系统既有相似之处，也有不同之处。如果您需要一个用于Web应用程序的，高安全性的关系型数据库管理系统，或者想要构建一个活跃用户超过数百万的面向消费者的app，那么MySQL将适合您的项目。如果你的需求围绕复杂的程序,复杂的设计,集成和数据完整性、事务支持,而不是在高速，那么,PostgreSQL将会是你项目理想的选择。</p>

        
        <!--原创-->
        
        <!--转载标注-->
        
        
      </div>
      <!--文章标签-->
      
      
      
    </div>
  </div>

  
  

  
  <!--评论-->
  
  
</div>

<script src="/js/readmore.js" type="text/javascript"></script>
<script>
  const btw = new BTWPlugin();
  btw.init({
    id: 'container',
    blogId: '10034-1569731208928-426',
    name: '恒宇少年',
    qrcode: 'https://blog.yuqiyu.com/images/mp.jpg',
    keyword: 'free',
  });
</script>

<!--<script src="/js/layui.js"></script>
<script>
  layui.use(['layer'], function () {
    var layer = layui.layer;
    var isShowOnce = localStorage.getItem('isShowHistory');
    if (!isShowOnce) {
      localStorage.setItem('isShowHistory',true);
      layer.open({
          type: 1
          ,title: false //不显示标题栏
          ,closeBtn: false
          ,area: '350px;'
          ,shade: 0.8
          ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
          ,btn: ['带朕去看看', '给朕退下']
          ,btnAlign: 'c'
          ,moveType: 1 //拖拽模式，0或者1
          ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-size:13px; font-weight: 300;">你知道吗？阿里云的采购季来了！！！<br/><br/>云产品低至<b>0.75折</b> </br></br>ECS服务器最低 <b>¥74.43</b>/年 ...<br><br>MySQL云数据库最低 <b>¥188</b>/年 ...<br><br>1.5万条的短信只需要 <b>¥540</b> <br/><br/>500G的CDN流量包更是优惠到极致了...</div>'
          ,success: function(layero){
            var btn = layero.find('.layui-layer-btn');
            btn.find('.layui-layer-btn0').attr({
              href: 'https://www.aliyun.com/minisite/goods?userCode=rqxni4zt&share_source=copy_link'
              ,target: '_blank'
            });
          }
        });
    }
  });
</script>-->


    
<div id="container">
  
  <div class="card" style="margin-bottom: 10px">
    
    <div class="card-content article ">
      <!--文章标题-->
      
      <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
        
        <a class="has-link-black-ter" href="/import-osm-data-into-mysql.html">将OpenStreetMap导出的OSM数据导入MySQL数据库</a>
        
      </h1>
      <!--完全自定义页面显示的访问次数-->
      
      
      <div class="level article-meta is-mobile is-overflow-x-auto" style="font-size: 15px">
        <div class="level-left">
          <!--文章类型-->
          
          
          
          <span
            style="float: left;padding: 1px 2px 1px 2px;margin-right: 5px;background-color: #5cb85c;color: white;text-align: center;border-radius:0.25em;font-size: 14px">
            原创</span>
          
          
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--发布时间-->
          <img src="/images/date_time.png" style="width: 25px;" title="发布时间"/>
          &nbsp;
          <span class="article-meta-element">2021-04-16</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--作者-->
          <img src="/images/author.svg" style="width: 23px" title="文章作者"/>

          <span class="article-meta-element">于起宇</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--目录列表-->
          
          <img src="/images/categories.svg" style="width: 20px;" title="文章所属目录列表"/>
          &nbsp;
          <div class="level-item article-meta-element">
            <!--读取config.yml文件内的目录配置-->
            
            
              
                
              
                
              
                
              
                
                  <!--跳转文章目录地址-->
                  <a class="category-link" href="/technical-talk.html">技术杂谈</a>&nbsp;
                
              
            
          </div>
          
          <!--不蒜子统计阅读量-->
          <!---->
        </div>
      </div>
      
      
      <!--推荐阅读 - 新闻-->
      
      <!--文章内容-->
      <div class="content">
        <h2 id="OpenStreetMap"><a href="#OpenStreetMap" class="headerlink" title="OpenStreetMap"></a>OpenStreetMap</h2><p><code>OpenStreetMap</code>是一个所有人都可以编辑并自由使用的世界地图。</p>
<p>其中的大部分内容由志愿者从无到有地构建起来，并以开放授权发布， OpenStreetMap版权协议允许所有人自由且免费使用我们的地图图像与地图数据，而且本项目鼓励把数据用于有趣崭新的用途。</p>
<p><strong>OpenStreetMap：</strong> <a href="https://www.openstreetmap.org/" target="_blank" rel="noopener">https://www.openstreetmap.org</a></p>
<h2 id="导出osm数据"><a href="#导出osm数据" class="headerlink" title="导出osm数据"></a>导出osm数据</h2><p>我们访问上面<code>OpenStreetMap</code>主页，我们可以看到跟其他提供地图服务的网站一样，也提供了位置导航的功能，也会直接定位到当前浏览的位置，那我们怎么才可以导出地图数据呢？</p>
<p><img src="/images/post/import-osm-data-into-mysql-1.png" alt="1"></p>
<p>我们访问页面的左上角有个<strong>导出</strong>的按钮，我们点击后可以看到如下图的界面：</p>
<p><img src="/images/post/import-osm-data-into-mysql-2.png" alt="2"></p>
<p>我们点击红框内的导出按钮可以导出上面默认区域（两个经纬度组成的区域）内的全部地图数据（街道、建筑等），导出数据文件的后缀格式为<code>.osm</code>，默认导出文件的名称为<code>map.osm</code>。</p>
<p>如果我们需要自定义导出的区域可以点击 “手动选择不同的区域”，通过拖拽的方式来定位区域的位置以及大小，如下图所示：</p>
<p><img src="/images/post/import-osm-data-into-mysql-3.png" alt></p>
<p>点击 <code>导出</code> 按钮就可以获得我们选中区域内的地图数据。</p>
<blockquote>
<p>注意事项：这种区域导出方式有个弊端，不能导出数据量超过50000个经纬度点的数据。</p>
</blockquote>
<h2 id="安装osmosis"><a href="#安装osmosis" class="headerlink" title="安装osmosis"></a>安装osmosis</h2><p>我们已经导出了地图数据（<code>map.osm</code>），我们可以通过<code>osmosis</code>来实现数据导入数据库，<code>osx</code>系统可以通过<code>brew</code>进行安装，如下所示：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yuqiyu@hengyu ~&gt; brew install osmosis</span><br></pre></td></tr></table></figure>

<h2 id="初始化数据库表"><a href="#初始化数据库表" class="headerlink" title="初始化数据库表"></a>初始化数据库表</h2><p>通过<code>osmosis</code>导入到数据库时，需要提前创建数据库以及数据表，点击 <a href="/files/mysql-apidb06.sql">下载MySQL建表语句</a>。</p>
<h2 id="导入数据库"><a href="#导入数据库" class="headerlink" title="导入数据库"></a>导入数据库</h2><figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yuqiyu@hengyu ~&gt; osmosis --<span class="hljs-built_in">read</span>-xml file=<span class="hljs-string">"/Users/yuqiyu/Downloads/map.osm"</span> --write-apidb-0.6 host=<span class="hljs-string">"127.0.0.1"</span> dbType=<span class="hljs-string">"mysql"</span> database=<span class="hljs-string">"api06_test"</span> user=<span class="hljs-string">"root"</span> password=<span class="hljs-string">"123456"</span> validateSchemaVersion=no</span><br></pre></td></tr></table></figure>

<h2 id="敲黑板，划重点"><a href="#敲黑板，划重点" class="headerlink" title="敲黑板，划重点"></a>敲黑板，划重点</h2><p>基于<code>OpenStreetMap</code>提供的开源道路数据我们可以做的事情有很多，拿到道路上的经纬度（<code>longitude</code>、<code>latitude</code>）地理位置后做一些独特的业务处理，比如：我可以清楚的知道某一条道路上有哪些业务车辆经过、建立自有业务的地图数据、规划工作路线等。</p>

        
        <!--原创-->
        
        <!--转载标注-->
        
        
      </div>
      <!--文章标签-->
      
      
      
    </div>
  </div>

  
  

  
  <!--评论-->
  
  
</div>

<script src="/js/readmore.js" type="text/javascript"></script>
<script>
  const btw = new BTWPlugin();
  btw.init({
    id: 'container',
    blogId: '10034-1569731208928-426',
    name: '恒宇少年',
    qrcode: 'https://blog.yuqiyu.com/images/mp.jpg',
    keyword: 'free',
  });
</script>

<!--<script src="/js/layui.js"></script>
<script>
  layui.use(['layer'], function () {
    var layer = layui.layer;
    var isShowOnce = localStorage.getItem('isShowHistory');
    if (!isShowOnce) {
      localStorage.setItem('isShowHistory',true);
      layer.open({
          type: 1
          ,title: false //不显示标题栏
          ,closeBtn: false
          ,area: '350px;'
          ,shade: 0.8
          ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
          ,btn: ['带朕去看看', '给朕退下']
          ,btnAlign: 'c'
          ,moveType: 1 //拖拽模式，0或者1
          ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-size:13px; font-weight: 300;">你知道吗？阿里云的采购季来了！！！<br/><br/>云产品低至<b>0.75折</b> </br></br>ECS服务器最低 <b>¥74.43</b>/年 ...<br><br>MySQL云数据库最低 <b>¥188</b>/年 ...<br><br>1.5万条的短信只需要 <b>¥540</b> <br/><br/>500G的CDN流量包更是优惠到极致了...</div>'
          ,success: function(layero){
            var btn = layero.find('.layui-layer-btn');
            btn.find('.layui-layer-btn0').attr({
              href: 'https://www.aliyun.com/minisite/goods?userCode=rqxni4zt&share_source=copy_link'
              ,target: '_blank'
            });
          }
        });
    }
  });
</script>-->


    
<div id="container">
  
  <div class="card" style="margin-bottom: 10px">
    
    <div class="card-content article ">
      <!--文章标题-->
      
      <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
        
        <a class="has-link-black-ter" href="/redis-geo-practice.html">实践：了解Redis Geo范围查询，获取当前位置最近的经纬度点</a>
        
      </h1>
      <!--完全自定义页面显示的访问次数-->
      
      
      <div class="level article-meta is-mobile is-overflow-x-auto" style="font-size: 15px">
        <div class="level-left">
          <!--文章类型-->
          
          
          
          <span
            style="float: left;padding: 1px 2px 1px 2px;margin-right: 5px;background-color: #5cb85c;color: white;text-align: center;border-radius:0.25em;font-size: 14px">
            原创</span>
          
          
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--发布时间-->
          <img src="/images/date_time.png" style="width: 25px;" title="发布时间"/>
          &nbsp;
          <span class="article-meta-element">2021-04-07</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--作者-->
          <img src="/images/author.svg" style="width: 23px" title="文章作者"/>

          <span class="article-meta-element">于起宇</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--目录列表-->
          
          <img src="/images/categories.svg" style="width: 20px;" title="文章所属目录列表"/>
          &nbsp;
          <div class="level-item article-meta-element">
            <!--读取config.yml文件内的目录配置-->
            
            
              
                
              
                
              
                
              
                
                  <!--跳转文章目录地址-->
                  <a class="category-link" href="/technical-talk.html">技术杂谈</a>&nbsp;
                
              
            
          </div>
          
          <!--不蒜子统计阅读量-->
          <!---->
        </div>
      </div>
      
      
      <!--推荐阅读 - 新闻-->
      
      <!--文章内容-->
      <div class="content">
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>近期有个获取车辆所处道路的需求，车辆行驶的范围在一个城市的市区内，针对一个城市的道路<strong>经纬度节点</strong>的数据量会比较大（就济南市而言，目前数据量在20万左右），数据的<code>准确性</code>以及<code>检索效率</code>是首要考虑的问题。</p>
<h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><ul>
<li><a href="https://blog.yuqiyu.com/spring-boot-2-x-articles.html" target="_blank" rel="noopener">SpringBoot2.x 教程汇总</a></li>
</ul>
<h2 id="Redis-Geo"><a href="#Redis-Geo" class="headerlink" title="Redis Geo"></a>Redis Geo</h2><p>经过一系列的调研后，由于数据的量级也还可以，决定采用<code>Redis Geo</code>来解决这个问题。</p>
<p><code>Redis</code>从<strong>3.2+</strong>版本开始对<code>Geo</code>的支持进行了增强，提供了可以根据给定经纬度点位置作为中心点，在指定范围内进行检索距离最近的经纬度点。</p>
<p>美团外卖、饿了么等APP上根据手机位置定位范围中（1km内）的商家，类似于这种的需求也可以使用<code>Redis Geo</code>来实现。</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">yuqiyu@hengyu ~&gt; redis-cli</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or <span class="hljs-built_in">set</span>)</span><br><span class="line">127.0.0.1:6379&gt; geoadd road:nodes:370100 117.1087416 36.7148919 point1 </span><br><span class="line">(<span class="hljs-built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd road:nodes:370100 117.1087006 36.7152294 point2 </span><br><span class="line">(<span class="hljs-built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="hljs-string">"road:nodes:370100"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 查询一条经纬度</span></span><br><span class="line">127.0.0.1:6379&gt; georadius road:nodes:370100 117.1089668 36.7151653 100 m withdist withcoord count 1</span><br><span class="line">1) 1) <span class="hljs-string">"point2"</span></span><br><span class="line">   2) <span class="hljs-string">"24.5815"</span></span><br><span class="line">   3) 1) <span class="hljs-string">"117.10870295763015747"</span></span><br><span class="line">      2) <span class="hljs-string">"36.7152294132502206"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 查询两条经纬度</span></span><br><span class="line">127.0.0.1:6379&gt; georadius road:nodes:370100 117.1089668 36.7151653 100 m withdist withcoord count 2</span><br><span class="line">1) 1) <span class="hljs-string">"point2"</span></span><br><span class="line">   2) <span class="hljs-string">"24.5815"</span></span><br><span class="line">   3) 1) <span class="hljs-string">"117.10870295763015747"</span></span><br><span class="line">      2) <span class="hljs-string">"36.7152294132502206"</span></span><br><span class="line">2) 1) <span class="hljs-string">"point1"</span></span><br><span class="line">   2) <span class="hljs-string">"36.4573"</span></span><br><span class="line">   3) 1) <span class="hljs-string">"117.10874050855636597"</span></span><br><span class="line">      2) <span class="hljs-string">"36.71489229533602838"</span></span><br></pre></td></tr></table></figure>

<h3 id="geoadd-命令"><a href="#geoadd-命令" class="headerlink" title="geoadd 命令"></a>geoadd 命令</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geoadd key longitude latitude member [longitude latitude member ...]</span><br></pre></td></tr></table></figure>

<ul>
<li><code>key</code>：geo集合的唯一键</li>
<li><code>longitude</code>：新增GPS位置的经度</li>
<li><code>latitude</code>：新增GPS位置的纬度</li>
<li><code>member</code>：该GPS位置的唯一标识</li>
</ul>
<h3 id="georadius-命令"><a href="#georadius-命令" class="headerlink" title="georadius 命令"></a>georadius 命令</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">georadius key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]</span><br></pre></td></tr></table></figure>

<ul>
<li><code>key</code>：geo集合的唯一键</li>
<li><code>longitude</code>：待检索的GPS经度</li>
<li><code>latutude</code>：待检索的GPS纬度</li>
<li><code>radius</code>：检索的范围，单位可选择：米（m）、千米（km）、英里（mi）、英尺（ft）</li>
<li><code>withcoord</code>：将匹配的经纬度输出</li>
<li><code>withdist</code>：将匹配经纬度的距离输出</li>
<li><code>count</code>：输出匹配的数量</li>
<li><code>asc|desc</code>：根据距离排序，asc：由近到远，desc：由远到近</li>
</ul>
<blockquote>
<p><code>georadius</code>指令会将给定的经纬度作为检索的中心点，在指定范围内进行检索匹配的经纬度点的位置。</p>
</blockquote>
<h2 id="检索实现"><a href="#检索实现" class="headerlink" title="检索实现"></a>检索实现</h2><p>在实践的过程中，使用了两种方式来进行测试，发现在检索的效率上有着轻微的差异，下面通过代码实践来进行比对。</p>
<h2 id="Spring-Data-方式检索"><a href="#Spring-Data-方式检索" class="headerlink" title="Spring Data 方式检索"></a>Spring Data 方式检索</h2><p><code>spring-boot-starter-data-redis</code>是<code>SpringBoot</code>提供用于操作<code>Redis</code>的依赖，内部集成的是<code>lettuce</code>，下面是通过<code>RedisTemplate</code>的方式来检索范围内的点的代码实现。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Spring Data方式测试Redis Geo</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 恒宇少年</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-meta">@SpringBootTest</span></span><br><span class="line"><span class="hljs-meta">@Slf</span>4j</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringDataRedisGeoTest</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Redis Geo Key</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String GEO_KEY = <span class="hljs-string">"road:nodes:370100"</span>;</span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 检索geo集合内的最近位置</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-meta">@Test</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">searchPoint</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">double</span> longitude = <span class="hljs-number">117.1089668</span>;</span><br><span class="line">        <span class="hljs-keyword">double</span> latitude = <span class="hljs-number">36.7151653</span>;</span><br><span class="line">        Point centerPoint = <span class="hljs-keyword">new</span> Point(longitude, latitude);</span><br><span class="line">        Distance distance = <span class="hljs-keyword">new</span> Distance(<span class="hljs-number">100</span>, RedisGeoCommands.DistanceUnit.METERS);</span><br><span class="line">        Circle circle = <span class="hljs-keyword">new</span> Circle(centerPoint, distance);</span><br><span class="line">        RedisGeoCommands.GeoRadiusCommandArgs args = RedisGeoCommands</span><br><span class="line">                .GeoRadiusCommandArgs</span><br><span class="line">                .newGeoRadiusArgs()</span><br><span class="line">                .includeDistance()</span><br><span class="line">                .includeCoordinates()</span><br><span class="line">                .sortAscending()</span><br><span class="line">                .limit(<span class="hljs-number">1</span>);</span><br><span class="line">        GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; radius = redisTemplate.boundGeoOps(GEO_KEY).radius(circle, args);</span><br><span class="line">        <span class="hljs-keyword">for</span> (GeoResult&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; result : radius) &#123;</span><br><span class="line">            RedisGeoCommands.GeoLocation&lt;String&gt; content = result.getContent();</span><br><span class="line">            log.info(<span class="hljs-string">"检索的结果，唯一标识：&#123;&#125;，位置：&#123;&#125;，距离：&#123;&#125;."</span>,</span><br><span class="line">                    content.getName(), content.getPoint(), result.getDistance());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Redission方式检索"><a href="#Redission方式检索" class="headerlink" title="Redission方式检索"></a>Redission方式检索</h2><p><code>Redisson</code>内部自定义封装了操作<code>Redis</code>的逻辑，对<code>Redis Geo</code>也做了支持，经过测试发现，<code>Redisson</code>方式要比<code>Spring Data</code>方式检索的效率高。</p>
<blockquote>
<p>以10万条数据为例，<code>Spring Data</code>方式检索需要300ms左右，而<code>Redisson</code>方式检索仅需要90ms左右。</p>
</blockquote>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Redisson方式测试Redis Geo</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 恒宇少年</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-meta">@SpringBootTest</span></span><br><span class="line"><span class="hljs-meta">@Slf</span>4j</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedissonRedisGeoTest</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String GEO_KEY = <span class="hljs-string">"road:nodes:370100"</span>;</span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    <span class="hljs-keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Test</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">searchPoint</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">double</span> longitude = <span class="hljs-number">117.1089668</span>;</span><br><span class="line">        <span class="hljs-keyword">double</span> latitude = <span class="hljs-number">36.7151653</span>;</span><br><span class="line">        RGeo&lt;String&gt; geo = redissonClient.getGeo(GEO_KEY, <span class="hljs-keyword">new</span> StringCodec());</span><br><span class="line">        GeoSearchArgs args = GeoSearchArgs.from(longitude, latitude)</span><br><span class="line">                .radius(<span class="hljs-number">100</span>, GeoUnit.METERS)</span><br><span class="line">                .order(GeoOrder.ASC)</span><br><span class="line">                .count(<span class="hljs-number">1</span>);</span><br><span class="line">        Map&lt;String, Double&gt; resultMap = geo.searchWithDistance(args);</span><br><span class="line">        resultMap.keySet().stream().forEach(member -&gt;</span><br><span class="line">                log.info(<span class="hljs-string">"检索结果，匹配位置的标识：&#123;&#125;，距离：&#123;&#125;."</span>, member, resultMap.get(member)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上两种方式操作<code>Redis Geo</code> 都是可以的，有一点要注意，如果集成了<code>Redisson</code>依赖，<code>Spring Data</code>方式无法获取<code>范围内点的Distance（距离）</code>。</p>

        
        <!--原创-->
        
        <!--转载标注-->
        
        
      </div>
      <!--文章标签-->
      
      
      
    </div>
  </div>

  
  

  
  <!--评论-->
  
  
</div>

<script src="/js/readmore.js" type="text/javascript"></script>
<script>
  const btw = new BTWPlugin();
  btw.init({
    id: 'container',
    blogId: '10034-1569731208928-426',
    name: '恒宇少年',
    qrcode: 'https://blog.yuqiyu.com/images/mp.jpg',
    keyword: 'free',
  });
</script>

<!--<script src="/js/layui.js"></script>
<script>
  layui.use(['layer'], function () {
    var layer = layui.layer;
    var isShowOnce = localStorage.getItem('isShowHistory');
    if (!isShowOnce) {
      localStorage.setItem('isShowHistory',true);
      layer.open({
          type: 1
          ,title: false //不显示标题栏
          ,closeBtn: false
          ,area: '350px;'
          ,shade: 0.8
          ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
          ,btn: ['带朕去看看', '给朕退下']
          ,btnAlign: 'c'
          ,moveType: 1 //拖拽模式，0或者1
          ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-size:13px; font-weight: 300;">你知道吗？阿里云的采购季来了！！！<br/><br/>云产品低至<b>0.75折</b> </br></br>ECS服务器最低 <b>¥74.43</b>/年 ...<br><br>MySQL云数据库最低 <b>¥188</b>/年 ...<br><br>1.5万条的短信只需要 <b>¥540</b> <br/><br/>500G的CDN流量包更是优惠到极致了...</div>'
          ,success: function(layero){
            var btn = layero.find('.layui-layer-btn');
            btn.find('.layui-layer-btn0').attr({
              href: 'https://www.aliyun.com/minisite/goods?userCode=rqxni4zt&share_source=copy_link'
              ,target: '_blank'
            });
          }
        });
    }
  });
</script>-->


    
<div id="container">
  
  <div class="card" style="margin-bottom: 10px">
    
    <div class="card-content article ">
      <!--文章标题-->
      
      <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
        
        <a class="has-link-black-ter" href="/message-pipe-release-1-0-2.html">顺序消息管道《Message Pipe》v1.0.2版本发布</a>
        
      </h1>
      <!--完全自定义页面显示的访问次数-->
      
      
      <div class="level article-meta is-mobile is-overflow-x-auto" style="font-size: 15px">
        <div class="level-left">
          <!--文章类型-->
          
          
          
          <span
            style="float: left;padding: 1px 2px 1px 2px;margin-right: 5px;background-color: #5cb85c;color: white;text-align: center;border-radius:0.25em;font-size: 14px">
            原创</span>
          
          
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--发布时间-->
          <img src="/images/date_time.png" style="width: 25px;" title="发布时间"/>
          &nbsp;
          <span class="article-meta-element">2020-09-07</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--作者-->
          <img src="/images/author.svg" style="width: 23px" title="文章作者"/>

          <span class="article-meta-element">于起宇</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--目录列表-->
          
          <img src="/images/categories.svg" style="width: 20px;" title="文章所属目录列表"/>
          &nbsp;
          <div class="level-item article-meta-element">
            <!--读取config.yml文件内的目录配置-->
            
            
              
                
              
                
              
                
              
                
                  <!--跳转文章目录地址-->
                  <a class="category-link" href="/technical-talk.html">技术杂谈</a>&nbsp;
                
              
            
          </div>
          
          <!--不蒜子统计阅读量-->
          <!---->
        </div>
      </div>
      
      
      <!--推荐阅读 - 新闻-->
      
      <!--文章内容-->
      <div class="content">
        <h2 id="Message-Pipe是什么？"><a href="#Message-Pipe是什么？" class="headerlink" title="Message Pipe是什么？"></a>Message Pipe是什么？</h2><p>它是<code>minbox</code>开源组织内的新成员，<code>Message Pipe</code>从字面的意思上理解为 “消息管道”，它确实是一个消息管道的定位，是基于<code>Redis</code>实现的分布式顺序消息管道。</p>
<h2 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h2><p>目前<code>Message Pipe</code>开源平台：</p>
<ul>
<li>GitHub：<a href="https://github.com/minbox-projects/message-pipe" target="_blank" rel="noopener">https://github.com/minbox-projects/message-pipe</a></li>
<li>Gitee：<a href="https://gitee.com/minbox-projects/message-pipe" target="_blank" rel="noopener">https://gitee.com/minbox-projects/message-pipe</a></li>
</ul>
<p>另外ApiBoot对它进行了集成，可以通过配置文件的形式快速把<code>message-pipe</code>加入到项目中，详见：<a href="https://github.com/minbox-projects/api-boot。" target="_blank" rel="noopener">https://github.com/minbox-projects/api-boot。</a><br>集成相关代码：<a href="https://github.com/minbox-projects/api-boot/tree/master/api-boot-project/api-boot-autoconfigure/src/main/java/org/minbox/framework/api/boot/autoconfigure/message/pipe" target="_blank" rel="noopener">https://github.com/minbox-projects/api-boot/tree/master/api-boot-project/api-boot-autoconfigure/src/main/java/org/minbox/framework/api/boot/autoconfigure/message/pipe</a></p>
<h2 id="可以解决什么问题？"><a href="#可以解决什么问题？" class="headerlink" title="可以解决什么问题？"></a>可以解决什么问题？</h2><p>它主要是来解决分布式系统下消息的顺序消费的方案，内部通过<code>Redisson</code>的分布式锁以及分布式队列的特性来完成消息的处理，消息的分发则是由<code>Grpc</code>来完成的。</p>
<p>消息分发时支持常见的负载均衡策略，比如：随机策略、IP轮询方式等。</p>
<p>由于内部采用的是分布式锁的方式实现，所以支持多个<code>Server</code>同时就行消息的轮询获取以及分发操作。</p>
<h2 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h2><p>详见：<a href="https://github.com/minbox-projects/message-pipe/releases/tag/1.0.2.RELEASE" target="_blank" rel="noopener">https://github.com/minbox-projects/message-pipe/releases/tag/1.0.2.RELEASE</a></p>
<h2 id="✨-New-Features"><a href="#✨-New-Features" class="headerlink" title="✨   New Features"></a>✨   New Features</h2><ul>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/75" target="_blank" rel="noopener">#75</a> ] 每个消息管道新增 ”MessagePipeDistributor“，用于自动分发管道内的消息</li>
</ul>
<h2 id="🐛-Fix-Bugs"><a href="#🐛-Fix-Bugs" class="headerlink" title="🐛  Fix Bugs"></a>🐛  Fix Bugs</h2><ul>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/77" target="_blank" rel="noopener">#77</a> ] 如果消息管道的数量超出配置上限，抛出异常提醒</li>
</ul>
<h2 id="🎨-Optimizations"><a href="#🎨-Optimizations" class="headerlink" title="🎨  Optimizations"></a>🎨  Optimizations</h2><ul>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/68" target="_blank" rel="noopener">#68</a> ] Server分发消息逻辑重构，优化线程池内线程占用CPU的使用率</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/70" target="_blank" rel="noopener">#70</a> ] 废除 “MessageDistributionExecutor” 概念，修改为 “MessageScheduler”</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/71" target="_blank" rel="noopener">#71</a> ] 废除 “MessagePipeMonitor” 公共消息管道监听器，为每个消息管道内的消息添加 “MessageMonitor”</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/72" target="_blank" rel="noopener">#72</a> ] 重构消息管道 “MessagePipe” ，内聚操作管道内消息的方法</li>
</ul>
<h2 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h2><p>为了快速上手，提供了<code>message-pipe</code>使用的示例项目，项目源码：<a href="https://github.com/minbox-projects/message-pipe-example" target="_blank" rel="noopener">https://github.com/minbox-projects/message-pipe-example</a>。</p>
<h3 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h3><p>由于<code>message-pipe</code>基于<code>Redis</code>实现，所以我们首先需要在本机安装<code>Redis</code>，下面是使用<code>Docker</code>方式安装步骤：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 拉取Redis镜像</span></span><br><span class="line">docker pull redis</span><br><span class="line"><span class="hljs-comment"># 创建一个名为"redis"的后台运行容器，端口号映射宿主机6379</span></span><br><span class="line">docker run --name redis -d -p 6379:6379 redis</span><br></pre></td></tr></table></figure>

<h3 id="查看Redis数据"><a href="#查看Redis数据" class="headerlink" title="查看Redis数据"></a>查看Redis数据</h3><figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 运行容器内命令</span></span><br><span class="line">docker <span class="hljs-built_in">exec</span> -it redis /bin/sh</span><br><span class="line"><span class="hljs-comment"># 运行Redis客户端</span></span><br><span class="line">redis-cli</span><br><span class="line"><span class="hljs-comment"># 选择索引为1的数据库</span></span><br><span class="line">select 1</span><br><span class="line"><span class="hljs-comment"># 查看全部的数据</span></span><br><span class="line">keys *</span><br></pre></td></tr></table></figure>

<h3 id="启动示例项目"><a href="#启动示例项目" class="headerlink" title="启动示例项目"></a>启动示例项目</h3><figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 下载源码</span></span><br><span class="line">git <span class="hljs-built_in">clone</span> https://github.com/minbox-projects/message-pipe-example.git</span><br><span class="line"><span class="hljs-comment"># 进入项目目录</span></span><br><span class="line"><span class="hljs-built_in">cd</span> message-pipe-example</span><br><span class="line"><span class="hljs-comment"># 运行Client与Server合并示例项目</span></span><br><span class="line"><span class="hljs-built_in">cd</span> client-server-merge</span><br><span class="line"><span class="hljs-comment"># 运行项目</span></span><br><span class="line">mvn spring-boot:run</span><br></pre></td></tr></table></figure>
        
        <!--原创-->
        
        <!--转载标注-->
        
        
      </div>
      <!--文章标签-->
      
      
      
    </div>
  </div>

  
  

  
  <!--评论-->
  
  
</div>

<script src="/js/readmore.js" type="text/javascript"></script>
<script>
  const btw = new BTWPlugin();
  btw.init({
    id: 'container',
    blogId: '10034-1569731208928-426',
    name: '恒宇少年',
    qrcode: 'https://blog.yuqiyu.com/images/mp.jpg',
    keyword: 'free',
  });
</script>

<!--<script src="/js/layui.js"></script>
<script>
  layui.use(['layer'], function () {
    var layer = layui.layer;
    var isShowOnce = localStorage.getItem('isShowHistory');
    if (!isShowOnce) {
      localStorage.setItem('isShowHistory',true);
      layer.open({
          type: 1
          ,title: false //不显示标题栏
          ,closeBtn: false
          ,area: '350px;'
          ,shade: 0.8
          ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
          ,btn: ['带朕去看看', '给朕退下']
          ,btnAlign: 'c'
          ,moveType: 1 //拖拽模式，0或者1
          ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-size:13px; font-weight: 300;">你知道吗？阿里云的采购季来了！！！<br/><br/>云产品低至<b>0.75折</b> </br></br>ECS服务器最低 <b>¥74.43</b>/年 ...<br><br>MySQL云数据库最低 <b>¥188</b>/年 ...<br><br>1.5万条的短信只需要 <b>¥540</b> <br/><br/>500G的CDN流量包更是优惠到极致了...</div>'
          ,success: function(layero){
            var btn = layero.find('.layui-layer-btn');
            btn.find('.layui-layer-btn0').attr({
              href: 'https://www.aliyun.com/minisite/goods?userCode=rqxni4zt&share_source=copy_link'
              ,target: '_blank'
            });
          }
        });
    }
  });
</script>-->


    
<div id="container">
  
  <div class="card" style="margin-bottom: 10px">
    
    <div class="card-content article ">
      <!--文章标题-->
      
      <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
        
        <a class="has-link-black-ter" href="/message-pipe-release-1-0-1.html">顺序消息管道《Message Pipe》v1.0.1版本发布</a>
        
      </h1>
      <!--完全自定义页面显示的访问次数-->
      
      
      <div class="level article-meta is-mobile is-overflow-x-auto" style="font-size: 15px">
        <div class="level-left">
          <!--文章类型-->
          
          
          
          <span
            style="float: left;padding: 1px 2px 1px 2px;margin-right: 5px;background-color: #5cb85c;color: white;text-align: center;border-radius:0.25em;font-size: 14px">
            原创</span>
          
          
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--发布时间-->
          <img src="/images/date_time.png" style="width: 25px;" title="发布时间"/>
          &nbsp;
          <span class="article-meta-element">2020-08-31</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--作者-->
          <img src="/images/author.svg" style="width: 23px" title="文章作者"/>

          <span class="article-meta-element">于起宇</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--目录列表-->
          
          <img src="/images/categories.svg" style="width: 20px;" title="文章所属目录列表"/>
          &nbsp;
          <div class="level-item article-meta-element">
            <!--读取config.yml文件内的目录配置-->
            
            
              
                
              
                
              
                
              
                
                  <!--跳转文章目录地址-->
                  <a class="category-link" href="/technical-talk.html">技术杂谈</a>&nbsp;
                
              
            
          </div>
          
          <!--不蒜子统计阅读量-->
          <!---->
        </div>
      </div>
      
      
      <!--推荐阅读 - 新闻-->
      
      <!--文章内容-->
      <div class="content">
        <h2 id="Message-Pipe是什么？"><a href="#Message-Pipe是什么？" class="headerlink" title="Message Pipe是什么？"></a>Message Pipe是什么？</h2><p>它是<code>minbox</code>开源组织内的新成员，<code>Message Pipe</code>从字面的意思上理解为 “消息管道”，它确实是一个消息管道的定位，是基于<code>Redis</code>实现的分布式顺序消息管道。</p>
<h2 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h2><p>目前<code>Message Pipe</code>开源平台以<code>GitHub</code>为主，<code>Gitee</code>则是一个同步库。</p>
<ul>
<li>GitHub：<a href="https://github.com/minbox-projects/message-pipe" target="_blank" rel="noopener">https://github.com/minbox-projects/message-pipe</a></li>
<li>Gitee：<a href="https://gitee.com/minbox-projects/message-pipe" target="_blank" rel="noopener">https://gitee.com/minbox-projects/message-pipe</a></li>
</ul>
<h2 id="可以解决什么问题？"><a href="#可以解决什么问题？" class="headerlink" title="可以解决什么问题？"></a>可以解决什么问题？</h2><p>它主要是来解决分布式系统下消息的顺序消费的方案，内部通过<code>Redisson</code>的分布式锁以及分布式队列的特性来完成消息的处理，消息的分发则是由<code>Grpc</code>来完成的。</p>
<p>消息分发时支持常见的负载均衡策略，比如：随机策略、IP轮询方式等。</p>
<p>由于内部采用的是分布式锁的方式实现，所以支持多个<code>Server</code>同时就行消息的轮询获取以及分发操作。</p>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul>
<li>自动注册</li>
<li>心跳检查</li>
<li>消息分发</li>
<li>顺序消费</li>
<li>读写分离</li>
<li>线程安全</li>
<li>负载均衡</li>
<li>自动剔除</li>
<li>…</li>
</ul>
<h2 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h2><p>详见：<a href="https://github.com/minbox-projects/message-pipe/releases/tag/1.0.1.RELEASE" target="_blank" rel="noopener">https://github.com/minbox-projects/message-pipe/releases/tag/1.0.1.RELEASE</a></p>
<h2 id="✨-New-Features"><a href="#✨-New-Features" class="headerlink" title="✨ New Features"></a>✨ New Features</h2><ul>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/39" target="_blank" rel="noopener">#39</a> ] Client通过 “Cglib动态代理” 的方式实现动态绑定管道</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/40" target="_blank" rel="noopener">#40</a> ] Client/Server 通过正则表达式进行匹配 “pipeName”</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/41" target="_blank" rel="noopener">#41</a> ] 禁用Server接收注册请求后根据每一个”Pipe Name”创建消息管道</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/47" target="_blank" rel="noopener">#47</a> ] 使用Jackson代替fastjson转换实体与json字符串之间的相互转换方式</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/51" target="_blank" rel="noopener">#51</a> ] MessageProcessor新增正则表达式方式处理消息，并为每个匹配的表达式管道建立一个Porxy代理类</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/59" target="_blank" rel="noopener">#59</a> ] Server启动时自动加载Redis内的消息管道列表，并自动创建MessagePipe实例</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/64" target="_blank" rel="noopener">#64</a> ] 重构Client连接Server的实现方式，新增支持Nacos NamingService方式</li>
</ul>
<h2 id="🐛-Fix-Bugs"><a href="#🐛-Fix-Bugs" class="headerlink" title="🐛 Fix Bugs"></a>🐛 Fix Bugs</h2><ul>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/pull/45" target="_blank" rel="noopener">#45</a> ] 修复Client启动时一直重试注册到Server，导致阻塞主线程</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/48" target="_blank" rel="noopener">#48</a> ] 删除客户端ReceiveMessageService处理消息时使用线程池</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/53" target="_blank" rel="noopener">#53</a> ] 修复Redisson在高并发下出现的解锁异常</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/55" target="_blank" rel="noopener">#55</a> ] 修复获取MessageProcessors实例时可能出现线程安全性问题</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/57" target="_blank" rel="noopener">#57</a> ] 消息分发时，只有存在客户端列表才进行处理消息发送逻辑</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/61" target="_blank" rel="noopener">#61</a> ] Server运行过程中CPU飙升</li>
<li>[ <a href="https://github.com/minbox-projects/message-pipe/issues/65" target="_blank" rel="noopener">#65</a> ] Client注册时偶尔会出现获取IP地址为 “127.0.0.1”的情况</li>
</ul>
<h2 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h2><p>为了快速上手，提供了<code>message-pipe</code>使用的示例项目，项目源码：<a href="https://github.com/minbox-projects/message-pipe-example" target="_blank" rel="noopener">https://github.com/minbox-projects/message-pipe-example</a>。</p>
<h3 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h3><p>由于<code>message-pipe</code>基于<code>Redis</code>实现，所以我们首先需要在本机安装<code>Redis</code>，下面是使用<code>Docker</code>方式安装步骤：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 拉取Redis镜像</span></span><br><span class="line">docker pull redis</span><br><span class="line"><span class="hljs-comment"># 创建一个名为"redis"的后台运行容器，端口号映射宿主机6379</span></span><br><span class="line">docker run --name redis -d -p 6379:6379 redis</span><br></pre></td></tr></table></figure>

<h3 id="查看Redis数据"><a href="#查看Redis数据" class="headerlink" title="查看Redis数据"></a>查看Redis数据</h3><figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 运行容器内命令</span></span><br><span class="line">docker <span class="hljs-built_in">exec</span> -it redis /bin/sh</span><br><span class="line"><span class="hljs-comment"># 运行Redis客户端</span></span><br><span class="line">redis-cli</span><br><span class="line"><span class="hljs-comment"># 选择索引为1的数据库</span></span><br><span class="line">select 1</span><br><span class="line"><span class="hljs-comment"># 查看全部的数据</span></span><br><span class="line">keys *</span><br></pre></td></tr></table></figure>

<h3 id="启动示例项目"><a href="#启动示例项目" class="headerlink" title="启动示例项目"></a>启动示例项目</h3><figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 下载源码</span></span><br><span class="line">git <span class="hljs-built_in">clone</span> https://github.com/minbox-projects/message-pipe-example.git</span><br><span class="line"><span class="hljs-comment"># 进入项目目录</span></span><br><span class="line"><span class="hljs-built_in">cd</span> message-pipe-example</span><br><span class="line"><span class="hljs-comment"># 运行Client与Server合并示例项目</span></span><br><span class="line"><span class="hljs-built_in">cd</span> client-server-merge</span><br><span class="line"><span class="hljs-comment"># 运行项目</span></span><br><span class="line">mvn spring-boot:run</span><br></pre></td></tr></table></figure>


        
        <!--原创-->
        
        <!--转载标注-->
        
        
      </div>
      <!--文章标签-->
      
      
      
    </div>
  </div>

  
  

  
  <!--评论-->
  
  
</div>

<script src="/js/readmore.js" type="text/javascript"></script>
<script>
  const btw = new BTWPlugin();
  btw.init({
    id: 'container',
    blogId: '10034-1569731208928-426',
    name: '恒宇少年',
    qrcode: 'https://blog.yuqiyu.com/images/mp.jpg',
    keyword: 'free',
  });
</script>

<!--<script src="/js/layui.js"></script>
<script>
  layui.use(['layer'], function () {
    var layer = layui.layer;
    var isShowOnce = localStorage.getItem('isShowHistory');
    if (!isShowOnce) {
      localStorage.setItem('isShowHistory',true);
      layer.open({
          type: 1
          ,title: false //不显示标题栏
          ,closeBtn: false
          ,area: '350px;'
          ,shade: 0.8
          ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
          ,btn: ['带朕去看看', '给朕退下']
          ,btnAlign: 'c'
          ,moveType: 1 //拖拽模式，0或者1
          ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-size:13px; font-weight: 300;">你知道吗？阿里云的采购季来了！！！<br/><br/>云产品低至<b>0.75折</b> </br></br>ECS服务器最低 <b>¥74.43</b>/年 ...<br><br>MySQL云数据库最低 <b>¥188</b>/年 ...<br><br>1.5万条的短信只需要 <b>¥540</b> <br/><br/>500G的CDN流量包更是优惠到极致了...</div>'
          ,success: function(layero){
            var btn = layero.find('.layui-layer-btn');
            btn.find('.layui-layer-btn0').attr({
              href: 'https://www.aliyun.com/minisite/goods?userCode=rqxni4zt&share_source=copy_link'
              ,target: '_blank'
            });
          }
        });
    }
  });
</script>-->


    
<div id="container">
  
  <div class="card" style="margin-bottom: 10px">
    
    <div class="card-content article ">
      <!--文章标题-->
      
      <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
        
        <a class="has-link-black-ter" href="/github-action-publish-jar-to-maven-central.html">使用GitHub Actions编译项目并将Jar发布到Maven Central仓库</a>
        
      </h1>
      <!--完全自定义页面显示的访问次数-->
      
      
      <div class="level article-meta is-mobile is-overflow-x-auto" style="font-size: 15px">
        <div class="level-left">
          <!--文章类型-->
          
          
          
          <span
            style="float: left;padding: 1px 2px 1px 2px;margin-right: 5px;background-color: #5cb85c;color: white;text-align: center;border-radius:0.25em;font-size: 14px">
            原创</span>
          
          
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--发布时间-->
          <img src="/images/date_time.png" style="width: 25px;" title="发布时间"/>
          &nbsp;
          <span class="article-meta-element">2020-08-09</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--作者-->
          <img src="/images/author.svg" style="width: 23px" title="文章作者"/>

          <span class="article-meta-element">于起宇</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--目录列表-->
          
          <img src="/images/categories.svg" style="width: 20px;" title="文章所属目录列表"/>
          &nbsp;
          <div class="level-item article-meta-element">
            <!--读取config.yml文件内的目录配置-->
            
            
              
                
              
                
              
                
              
                
                  <!--跳转文章目录地址-->
                  <a class="category-link" href="/technical-talk.html">技术杂谈</a>&nbsp;
                
              
            
          </div>
          
          <!--不蒜子统计阅读量-->
          <!---->
        </div>
      </div>
      
      
      <!--推荐阅读 - 新闻-->
      
      <!--文章内容-->
      <div class="content">
        <p>在上一篇 <a href="https://blog.yuqiyu.com/github-action-getting-started.html" target="_blank" rel="noopener">GitHub Actions使用入门</a> 文章中，我们了解到了该怎么去启用<code>GitHub Actions</code>功能，本篇文章来介绍下使用<code>GitHub Actions</code>怎么将我们的开源项目自动化构建后发布到<code>Maven Central</code>仓库中。</p>
<h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><ul>
<li><a href="https://blog.yuqiyu.com/spring-boot-2-x-articles.html" target="_blank" rel="noopener">SpringBoot2.x 教程汇总</a></li>
</ul>
<h2 id="新建workflow文件"><a href="#新建workflow文件" class="headerlink" title="新建workflow文件"></a>新建workflow文件</h2><p>本篇文章以我的开源框架 <a href="https://github.com/minbox-projects/api-boot" target="_blank" rel="noopener">ApiBoot</a> 为例，大家有兴趣的也可以去了解下这个开源框架，详情请访问：<a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_blank" rel="noopener">ApiBoot是什么？</a></p>
<p>在上一篇文章中我们提到过，<code>GitHub Actions</code>所需要的工作流文件要在<code>.github/workflows</code>文件夹内创建，那么接下来我们创建一个名为<code>deploy.yml</code>的工作流配置文件，配置<code>name</code>为该工作流的名称，如下所示：</p>
<figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># This is a basic workflow to help you get started with Actions</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">name:</span> <span class="hljs-string">Publish</span> <span class="hljs-string">package</span> <span class="hljs-string">to</span> <span class="hljs-string">the</span> <span class="hljs-string">Maven</span> <span class="hljs-string">Central</span> <span class="hljs-string">Repository</span></span><br></pre></td></tr></table></figure>

<h2 id="配置触发的分支"><a href="#配置触发的分支" class="headerlink" title="配置触发的分支"></a>配置触发的分支</h2><p>我们还需要配置当前工作流在什么情况进行触发自动构建的事件，在<code>deploy.yml</code>配置文件内添加触发事件，如下所示：</p>
<figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># Controls when the action will run. Triggers the workflow on push or pull request</span></span><br><span class="line"><span class="hljs-comment"># events but only for the master branch</span></span><br><span class="line"><span class="hljs-attr">on:</span></span><br><span class="line">  <span class="hljs-attr">push:</span></span><br><span class="line">    <span class="hljs-attr">branches:</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-string">master</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-number">2.3</span><span class="hljs-string">.x</span></span><br><span class="line">  <span class="hljs-attr">pull_request:</span></span><br><span class="line">    <span class="hljs-attr">branches:</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-string">master</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-number">2.3</span><span class="hljs-string">.x</span></span><br></pre></td></tr></table></figure>

<p>在上面我们配置了两种触发工作流程的事件，分别是：<code>push</code>、<code>pull_request</code>，也就是仓库收到推送更新以及<code>pull_request</code>时就会触发该工作流程，实现自动化构建。</p>
<p><code>GitHub Actions</code>其实为我们提供了多种触发工作流程的事件，访问 <a href="https://docs.github.com/cn/actions/reference/events-that-trigger-workflows" target="_blank" rel="noopener">触发工作流程的事件</a> 了解详情。</p>
<h2 id="配置工作任务"><a href="#配置工作任务" class="headerlink" title="配置工作任务"></a>配置工作任务</h2><p>触发事件配置完成后我们就需要来配置当前工作流程所需要的<code>系统环境</code>以及<code>每一个步骤</code>所需要做的事情了。</p>
<h3 id="构建系统"><a href="#构建系统" class="headerlink" title="构建系统"></a>构建系统</h3><p><code>GitHub Actions</code>支持针对工作流程中的每一个任务（<code>Job</code>）进行配置独立的构建系统版本，我们选择最新版本的<code>Ubuntu</code>来作为本次任务的运行系统环境，配置内容如下所示：</p>
<figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span></span><br><span class="line"><span class="hljs-attr">jobs:</span></span><br><span class="line">  <span class="hljs-comment"># This workflow contains a single job called "build"</span></span><br><span class="line">  <span class="hljs-attr">build:</span></span><br><span class="line">    <span class="hljs-comment"># The type of runner that the job will run on</span></span><br><span class="line">    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span></span><br></pre></td></tr></table></figure>

<p>我们今天文章的主题是<code>Jar发布到Maven Central仓库</code>，根据分析我们大约需要三个步骤来完成这一工作。</p>
<h3 id="Step1：检出代码"><a href="#Step1：检出代码" class="headerlink" title="Step1：检出代码"></a>Step1：检出代码</h3><p>首先我们需要将项目的源码检出到构建环境中，这时我们就可以借助<code>GitHub Actions</code>官方提供的<code>actions/checkout</code>来完成这一步骤，Action源码：<a href="https://github.com/actions/checkout" target="_blank" rel="noopener">https://github.com/actions/checkout</a></p>
<h3 id="Step2：安装环境"><a href="#Step2：安装环境" class="headerlink" title="Step2：安装环境"></a>Step2：安装环境</h3><p><a href="https://github.com/minbox-projects/api-boot" target="_blank" rel="noopener">ApiBoot</a> 是一个<strong>Java</strong>项目（<code>JDK1.8+</code>），而且采用<code>Maven</code>进行构建项目，所以我们需要在构建的环境中安装相关的环境支持，<code>GitHub Actions</code>官方同样提供了相关的<code>Action</code>，名为：<code>actions/setup-java</code>，Action源码：<a href="https://github.com/actions/setup-java" target="_blank" rel="noopener">https://github.com/actions/setup-java</a></p>
<h3 id="Step3：执行发布"><a href="#Step3：执行发布" class="headerlink" title="Step3：执行发布"></a>Step3：执行发布</h3><p>最后一步我们就需要通过<code>mvn deploy</code>命令来完成发布<code>Jar</code>，由于项目发布到<code>Release</code>仓库时需要<code>GPG</code>秘钥的支持，而我们期望的只是自动发布快照版本，所以可以通过<code>-Dgpg.skip</code>来排除<code>GPG</code>插件的介入。</p>
<p>全部步骤的配置内容如下所示：</p>
<figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span></span><br><span class="line"><span class="hljs-attr">jobs:</span></span><br><span class="line">    <span class="hljs-comment"># Steps represent a sequence of tasks that will be executed as part of the job</span></span><br><span class="line">    <span class="hljs-attr">steps:</span></span><br><span class="line">      <span class="hljs-comment"># Checkout source code</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span></span><br><span class="line">      <span class="hljs-comment"># Install Java 1.8</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v1</span></span><br><span class="line">        <span class="hljs-attr">with:</span></span><br><span class="line">          <span class="hljs-attr">server-id:</span> <span class="hljs-string">hengyu</span></span><br><span class="line">          <span class="hljs-attr">java-version:</span> <span class="hljs-number">1.8</span></span><br><span class="line">          <span class="hljs-attr">server-username:</span> <span class="hljs-string">MAVEN_USERNAME</span></span><br><span class="line">          <span class="hljs-attr">server-password:</span> <span class="hljs-string">MAVEN_PASSWORD</span></span><br><span class="line">      <span class="hljs-comment"># Publish to Apache Maven Central</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">mvn</span> <span class="hljs-string">-B</span> <span class="hljs-string">deploy</span> <span class="hljs-string">-Dgpg.skip</span></span><br><span class="line">        <span class="hljs-attr">env:</span></span><br><span class="line">          <span class="hljs-attr">MAVEN_USERNAME:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.MAVEN_CENTER_USER_NAME</span> <span class="hljs-string">&#125;&#125;</span></span><br><span class="line">          <span class="hljs-attr">MAVEN_PASSWORD:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.MAVEN_CENTER_PASSWORD</span> <span class="hljs-string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意事项：使用<code>Action</code>时，需要指定版本号，通过<code>@v?</code>的这种方式，其实这个版本号是仓库源码的<code>标签</code>。</p>
</blockquote>
<h2 id="配置GitHub-Secrets"><a href="#配置GitHub-Secrets" class="headerlink" title="配置GitHub Secrets"></a>配置GitHub Secrets</h2><p><code>actions/setup-java@v1</code>在执行时会创建Maven所需要的<code>settings.xml</code>文件，而在该文件内我们可以通过配置<code>server-username</code>、<code>server-password</code>来指定发布的目标仓库的用户名、密码。</p>
<p>由于该工作流配置文件是公开的，<strong>我们肯定不会明文进行配置</strong>，<code>GitHub</code>针对这一点，提供了<code>Secrets</code>配置的方式，我们需要将存在安全性的变量进行配置，使用时注意变量名称的对应即可。</p>
<p><img src="https://blog.yuqiyu.com/images/post/github-action-publish-jar-to-maven-central-1.png" alt></p>
<p><code>Secrets</code>在使用时需要根据约定的格式配置：</p>
<figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.MAVEN_CENTER_USER_NAME</span> <span class="hljs-string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>secrets</code>为前缀，而后面的变量名必须与<code>GitHub</code>内的配置一致，如果你的相关<code>Secrets</code>配置需要用于多个项目，可以在组织下进行配置。</p>
</blockquote>
<h2 id="推送更新"><a href="#推送更新" class="headerlink" title="推送更新"></a>推送更新</h2><p>到目前为止，我们的项目已经完成了<code>GitHub Actions</code>的配置，接下来需要将该工作流程配置文件推送()<code>push</code>)到目标仓库，推送后我们查看项目的<code>Actions</code>标签页的内容，如下所示：</p>
<p><img src="https://blog.yuqiyu.com/images/post/github-action-publish-jar-to-maven-central-2.png" alt></p>
<p><strong>每当我们推送代码时都会自动触发构建工作流程的事件，一个工作流程的任务都会有完整的日志记录</strong>，如下所示：</p>
<p><img src="https://blog.yuqiyu.com/images/post/github-action-publish-jar-to-maven-central-3.png" alt></p>
<blockquote>
<p>当一个任务的全部步骤都执行成功后，当前任务也算是真正的执行成功，如果一个工作流程文件内配置了多个任务，则是需要多个任务都构建成功后才算成功。</p>
</blockquote>
<h2 id="槽点"><a href="#槽点" class="headerlink" title="槽点"></a>槽点</h2><p>目前针对<code>GPG</code>的支持确实有点问题，<code>GitHub</code>官方所提供的<code>Action</code>也是会有一些问题，导致无法完成通过<code>GPG</code>的方式完成构建项目，如果这一点可以解决，就可以实现在<code>GitHub</code>仓库创建发布版本时触发工作事件，实现自动上传<code>Jar</code>到<code>Release</code>仓库，省去了在本地发布的工作。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>本文的<code>workflow</code>配置文件内容可以访问：<a href="https://github.com/minbox-projects/api-boot/blob/2.3.x/.github/workflows/deploy.yml" target="_blank" rel="noopener">https://github.com/minbox-projects/api-boot/blob/2.3.x/.github/workflows/deploy.yml</a> 。</p>

        
        <!--原创-->
        
        <!--转载标注-->
        
        
      </div>
      <!--文章标签-->
      
      
      
    </div>
  </div>

  
  

  
  <!--评论-->
  
  
</div>

<script src="/js/readmore.js" type="text/javascript"></script>
<script>
  const btw = new BTWPlugin();
  btw.init({
    id: 'container',
    blogId: '10034-1569731208928-426',
    name: '恒宇少年',
    qrcode: 'https://blog.yuqiyu.com/images/mp.jpg',
    keyword: 'free',
  });
</script>

<!--<script src="/js/layui.js"></script>
<script>
  layui.use(['layer'], function () {
    var layer = layui.layer;
    var isShowOnce = localStorage.getItem('isShowHistory');
    if (!isShowOnce) {
      localStorage.setItem('isShowHistory',true);
      layer.open({
          type: 1
          ,title: false //不显示标题栏
          ,closeBtn: false
          ,area: '350px;'
          ,shade: 0.8
          ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
          ,btn: ['带朕去看看', '给朕退下']
          ,btnAlign: 'c'
          ,moveType: 1 //拖拽模式，0或者1
          ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-size:13px; font-weight: 300;">你知道吗？阿里云的采购季来了！！！<br/><br/>云产品低至<b>0.75折</b> </br></br>ECS服务器最低 <b>¥74.43</b>/年 ...<br><br>MySQL云数据库最低 <b>¥188</b>/年 ...<br><br>1.5万条的短信只需要 <b>¥540</b> <br/><br/>500G的CDN流量包更是优惠到极致了...</div>'
          ,success: function(layero){
            var btn = layero.find('.layui-layer-btn');
            btn.find('.layui-layer-btn0').attr({
              href: 'https://www.aliyun.com/minisite/goods?userCode=rqxni4zt&share_source=copy_link'
              ,target: '_blank'
            });
          }
        });
    }
  });
</script>-->


    
<div id="container">
  
  <div class="card" style="margin-bottom: 10px">
    
    <div class="card-content article ">
      <!--文章标题-->
      
      <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
        
        <a class="has-link-black-ter" href="/github-action-getting-started.html">GitHub Actions使用入门</a>
        
      </h1>
      <!--完全自定义页面显示的访问次数-->
      
      
      <div class="level article-meta is-mobile is-overflow-x-auto" style="font-size: 15px">
        <div class="level-left">
          <!--文章类型-->
          
          
          
          <span
            style="float: left;padding: 1px 2px 1px 2px;margin-right: 5px;background-color: #5cb85c;color: white;text-align: center;border-radius:0.25em;font-size: 14px">
            原创</span>
          
          
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--发布时间-->
          <img src="/images/date_time.png" style="width: 25px;" title="发布时间"/>
          &nbsp;
          <span class="article-meta-element">2020-08-08</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--作者-->
          <img src="/images/author.svg" style="width: 23px" title="文章作者"/>

          <span class="article-meta-element">于起宇</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--目录列表-->
          
          <img src="/images/categories.svg" style="width: 20px;" title="文章所属目录列表"/>
          &nbsp;
          <div class="level-item article-meta-element">
            <!--读取config.yml文件内的目录配置-->
            
            
              
                
              
                
              
                
              
                
                  <!--跳转文章目录地址-->
                  <a class="category-link" href="/technical-talk.html">技术杂谈</a>&nbsp;
                
              
            
          </div>
          
          <!--不蒜子统计阅读量-->
          <!---->
        </div>
      </div>
      
      
      <!--推荐阅读 - 新闻-->
      
      <!--文章内容-->
      <div class="content">
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a href="https://github.com/features/actions" target="_blank" rel="noopener">GitHub Actions</a> 是由<code>GitHub</code>在<strong>2018</strong>年推出的一款持续集成的服务方案，对于<code>GitHub</code>上托管的开源项目来说比较友好，集成使用简单，个人感觉比 <a href="https://www.travis-ci.org/github/minbox-projects/api-boot" target="_blank" rel="noopener">Travis-CI</a> 玩法要更多，而且还是可以自己去编写<code>Actions</code>在构建的过程中使用。</p>
<h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><ul>
<li><a href="https://blog.yuqiyu.com/spring-boot-2-x-articles.html" target="_blank" rel="noopener">SpringBoot2.x 教程汇总</a></li>
</ul>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p><code>GitHub Actions</code>内有一些概念性的定义，如下所示：</p>
<ul>
<li><strong>workflow</strong>：顾名思义这是工作流程，在<code>GitHub Actions</code>中每执行一次就是一个工作流程。</li>
<li><strong>job</strong>：工作流程中的一个任务，一个工作流程可以配置多个任务</li>
<li><strong>step</strong>：工作任务中的步骤，根据配置的先后顺序执行，一个任务内可以配置多个步骤</li>
<li><strong>action</strong>：每个步骤所使用的构建动作，可以使用<code>GitHub</code>官方提供的动作实现，也可以自动编写。</li>
</ul>
<h2 id="使用GitHub-Actions"><a href="#使用GitHub-Actions" class="headerlink" title="使用GitHub Actions"></a>使用GitHub Actions</h2><p><img src="https://blog.yuqiyu.com/images/post/github-action-getting-started-1.png" alt></p>
<p>当我们打开项目的主页时可以看到<code>Actions</code>功能标签页，这就是该仓库的<code>GitHub Actions</code>，如果你的仓库没有添加过<code>workflow</code>文件，看到的效果如下所示：</p>
<p><img src="https://blog.yuqiyu.com/images/post/github-action-getting-started-2.png" alt></p>
<h2 id="配置Workflow-YML"><a href="#配置Workflow-YML" class="headerlink" title="配置Workflow YML"></a>配置Workflow YML</h2><p>每一个工作流都是由一个<code>YML</code>文件进行配置的，在该文件内我们可以配置仓库的<code>GitHub Actions</code>所相关的全部内容，<code>GitHub</code>针对文件所处的目录进行了约定，必须在仓库根下的<code>.github/workflows</code>目录内。</p>
<h3 id="方式一：直接在GitHub页面上添加"><a href="#方式一：直接在GitHub页面上添加" class="headerlink" title="方式一：直接在GitHub页面上添加"></a>方式一：直接在GitHub页面上添加</h3><p>在上面的截图中，我们点击<code>set up a workflow yourself -&gt;</code>回跳转添加<code>workflow</code>文件的页面，在该页面中我们可以修改文件名，也可以修改<code>workflow</code>文件的配置内容，如下所示：</p>
<p><img src="https://blog.yuqiyu.com/images/post/github-action-getting-started-3.png" alt></p>
<h3 id="方式二：项目源码中添加后推送"><a href="#方式二：项目源码中添加后推送" class="headerlink" title="方式二：项目源码中添加后推送"></a>方式二：项目源码中添加后推送</h3><p>我们也可以在项目源码中添加后进行推送，首先在项目的根目录下创建<code>.github/workflows</code>目录，然后在新创建的目录下添加一个名为<code>deploy.yml</code>的工作流配置文件，将修改提交后<code>push</code>到<code>GitHub</code>仓库即可。</p>
<h2 id="GitHub提供的Actions"><a href="#GitHub提供的Actions" class="headerlink" title="GitHub提供的Actions"></a>GitHub提供的Actions</h2><p><code>GitHub</code>官方所提供的<code>Actions</code>都是开源的，而且都位于 <a href="https://github.com/actions" target="_blank" rel="noopener">https://github.com/actions</a> 开源组织下，比较常用到的<code>Actions</code>：</p>
<ol>
<li><code>checkout</code>：用于checkout一个仓库源码到构建环境中</li>
<li><code>setup-java</code>：用于安装<code>Maven</code>、<code>JDK</code>等构建项目的依赖到构建环境中</li>
<li><code>setup-node</code>：用于安装<code>nodeJs</code>到构建环境中</li>
<li>…</li>
</ol>

        
        <!--原创-->
        
        <!--转载标注-->
        
        
      </div>
      <!--文章标签-->
      
      
      
    </div>
  </div>

  
  

  
  <!--评论-->
  
  
</div>

<script src="/js/readmore.js" type="text/javascript"></script>
<script>
  const btw = new BTWPlugin();
  btw.init({
    id: 'container',
    blogId: '10034-1569731208928-426',
    name: '恒宇少年',
    qrcode: 'https://blog.yuqiyu.com/images/mp.jpg',
    keyword: 'free',
  });
</script>

<!--<script src="/js/layui.js"></script>
<script>
  layui.use(['layer'], function () {
    var layer = layui.layer;
    var isShowOnce = localStorage.getItem('isShowHistory');
    if (!isShowOnce) {
      localStorage.setItem('isShowHistory',true);
      layer.open({
          type: 1
          ,title: false //不显示标题栏
          ,closeBtn: false
          ,area: '350px;'
          ,shade: 0.8
          ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
          ,btn: ['带朕去看看', '给朕退下']
          ,btnAlign: 'c'
          ,moveType: 1 //拖拽模式，0或者1
          ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-size:13px; font-weight: 300;">你知道吗？阿里云的采购季来了！！！<br/><br/>云产品低至<b>0.75折</b> </br></br>ECS服务器最低 <b>¥74.43</b>/年 ...<br><br>MySQL云数据库最低 <b>¥188</b>/年 ...<br><br>1.5万条的短信只需要 <b>¥540</b> <br/><br/>500G的CDN流量包更是优惠到极致了...</div>'
          ,success: function(layero){
            var btn = layero.find('.layui-layer-btn');
            btn.find('.layui-layer-btn0').attr({
              href: 'https://www.aliyun.com/minisite/goods?userCode=rqxni4zt&share_source=copy_link'
              ,target: '_blank'
            });
          }
        });
    }
  });
</script>-->


    
<div id="container">
  
  <div class="card" style="margin-bottom: 10px">
    
    <div class="card-content article ">
      <!--文章标题-->
      
      <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
        
        <a class="has-link-black-ter" href="/mp4-convert-to-gif.html">无意间发现一个好用的视频转换gif图片的开源框架</a>
        
      </h1>
      <!--完全自定义页面显示的访问次数-->
      
      
      <div class="level article-meta is-mobile is-overflow-x-auto" style="font-size: 15px">
        <div class="level-left">
          <!--文章类型-->
          
          
          
          <span
            style="float: left;padding: 1px 2px 1px 2px;margin-right: 5px;background-color: #5cb85c;color: white;text-align: center;border-radius:0.25em;font-size: 14px">
            原创</span>
          
          
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--发布时间-->
          <img src="/images/date_time.png" style="width: 25px;" title="发布时间"/>
          &nbsp;
          <span class="article-meta-element">2020-08-04</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--作者-->
          <img src="/images/author.svg" style="width: 23px" title="文章作者"/>

          <span class="article-meta-element">于起宇</span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <!--目录列表-->
          
          <img src="/images/categories.svg" style="width: 20px;" title="文章所属目录列表"/>
          &nbsp;
          <div class="level-item article-meta-element">
            <!--读取config.yml文件内的目录配置-->
            
            
              
                
              
                
              
                
              
                
                  <!--跳转文章目录地址-->
                  <a class="category-link" href="/technical-talk.html">技术杂谈</a>&nbsp;
                
              
            
          </div>
          
          <!--不蒜子统计阅读量-->
          <!---->
        </div>
      </div>
      
      
      <!--推荐阅读 - 新闻-->
      
      <!--文章内容-->
      <div class="content">
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>Gifify</code>是一款工具类的开源框架，可以将任何视频文件转换为优化的动画GIF。</p>
<ul>
<li>GitHub：<a href="https://github.com/vvo/gifify" target="_blank" rel="noopener">https://github.com/vvo/gifify</a></li>
</ul>
<blockquote>
<p>有些时候我们需要将<code>视频转换为动画GIF图</code>，可以更<strong>生动形象</strong>的描述我们想要说明的事物以及框架的使用方式，它对于程序员来说是一个<code>不可或缺的工具</code>之一。</p>
</blockquote>
<h2 id="环境支持"><a href="#环境支持" class="headerlink" title="环境支持"></a>环境支持</h2><p>在安装<code>Gifify</code>之前首先我们需要先安装它所需要的运行环境：</p>
<ul>
<li><strong>Node.js</strong>（<code>brew install node</code>）</li>
<li><strong>FFmpeg</strong>（<code>brew install ffmpeg</code>）</li>
<li><strong>ImageMagick</strong>（<code>brew install imagemagick</code>）</li>
<li><strong>giflossy</strong>（<code>brew install giflossy</code>）</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>可以通过<code>npm</code>直接安装<code>Gifify</code>，如下所示：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g gifify</span><br></pre></td></tr></table></figure>

<h2 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h2><p>下面是<code>Gifify</code>所支持的命令行参数列表。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ gifify -h</span><br><span class="line">Usage: gifify [options] [file]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -V, --version           output the version number</span><br><span class="line">  --colors &lt;n&gt;            Number of colors, up to 255, defaults to 80 (default: 80)</span><br><span class="line">  --compress &lt;n&gt;          Compression (quality) level, from 0 (no compression) to 100, defaults to 40 (default: 40)</span><br><span class="line">  --from &lt;position&gt;       Start position, hh:mm:ss or seconds, defaults to 0</span><br><span class="line">  --fps &lt;n&gt;               Frames Per Second, defaults to 10 (default: 10)</span><br><span class="line">  -o, --output &lt;file&gt;     Output file, defaults to stdout</span><br><span class="line">  --resize &lt;W:H&gt;          Resize output, use -1 when specifying only width or height. `350:100`, `400:-1`, `-1:200`</span><br><span class="line">  --reverse               Reverses movie</span><br><span class="line">  --speed &lt;n&gt;             Movie speed, defaults to 1 (default: 1)</span><br><span class="line">  --subtitles &lt;filepath&gt;  Subtitle filepath to burn to the GIF</span><br><span class="line">  --text &lt;string&gt;         Add some text at the bottom of the movie</span><br><span class="line">  --to &lt;position&gt;         End position, hh:mm:ss or seconds, defaults to end of movie</span><br><span class="line">  --no-loop               Will show every frame once without looping</span><br><span class="line">  -h, --help              output usage information</span><br></pre></td></tr></table></figure>

<h2 id="视频转换为GIF"><a href="#视频转换为GIF" class="headerlink" title="视频转换为GIF"></a>视频转换为GIF</h2><p>我使用Mac自带的屏幕录制软件<code>QuickTime Player</code>录制了一个测试视频，根据上面的命令行参数来看如果我们不做一些其他的自定义，只添加<code>-o、--output</code>输出的gif文件名即可，如下所示：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜ gifify 屏幕录制2020-08-05\ 上午8.58.01.mov --output example.gif</span><br><span class="line">Generating GIF, please <span class="hljs-built_in">wait</span>...</span><br></pre></td></tr></table></figure>

<p>当我们看到提示信息<code>Generating GIF, please wait...</code>时，说明已经开始转换了，因为视频文件的大小有差异，所以转换所需要的时间也所有不同。</p>
<blockquote>
<p>自动创建的<code>example.gif</code>文件与转换的视频文件在同一目录下。</p>
</blockquote>
<p><img src="https://blog.yuqiyu.com/images/post/mp4-convert-to-gif-1.gif" alt></p>
<h2 id="GIF截取"><a href="#GIF截取" class="headerlink" title="GIF截取"></a>GIF截取</h2><p>如果你只需要转换视频中的一个时间段，我们可以通过指定<code>--from</code>、<code>--to</code>参数来配置，如下所示：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜ gifify 屏幕录制2020-08-05\ 上午8.58.01.mov --output example.gif --from 00:00:10 --to 00:00:15</span><br></pre></td></tr></table></figure>

<h2 id="GIF压缩"><a href="#GIF压缩" class="headerlink" title="GIF压缩"></a>GIF压缩</h2><p><code>Gifify</code>默认压缩比例为<code>40%</code>，压缩后的Gif图可能会比较模糊，我们可以通过<code>--compress</code>参数来修改压缩比例，<strong>0</strong>表示无压缩，取值范围为<code>0~100</code>，如下所示：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜ gifify 屏幕录制2020-08-05\ 上午8.58.01.mov --output example.gif --from 00:00:10 --to 00:00:12 --compress 0</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><code>Gifify</code>还有很多隐藏的功能，比如在GIF图片上添加文字描述，缩放视频比例，反转视频等功能，赶快去发掘它的隐藏功能吧。</p>

        
        <!--原创-->
        
        <!--转载标注-->
        
        
      </div>
      <!--文章标签-->
      
      
      
    </div>
  </div>

  
  

  
  <!--评论-->
  
  
</div>

<script src="/js/readmore.js" type="text/javascript"></script>
<script>
  const btw = new BTWPlugin();
  btw.init({
    id: 'container',
    blogId: '10034-1569731208928-426',
    name: '恒宇少年',
    qrcode: 'https://blog.yuqiyu.com/images/mp.jpg',
    keyword: 'free',
  });
</script>

<!--<script src="/js/layui.js"></script>
<script>
  layui.use(['layer'], function () {
    var layer = layui.layer;
    var isShowOnce = localStorage.getItem('isShowHistory');
    if (!isShowOnce) {
      localStorage.setItem('isShowHistory',true);
      layer.open({
          type: 1
          ,title: false //不显示标题栏
          ,closeBtn: false
          ,area: '350px;'
          ,shade: 0.8
          ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
          ,btn: ['带朕去看看', '给朕退下']
          ,btnAlign: 'c'
          ,moveType: 1 //拖拽模式，0或者1
          ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-size:13px; font-weight: 300;">你知道吗？阿里云的采购季来了！！！<br/><br/>云产品低至<b>0.75折</b> </br></br>ECS服务器最低 <b>¥74.43</b>/年 ...<br><br>MySQL云数据库最低 <b>¥188</b>/年 ...<br><br>1.5万条的短信只需要 <b>¥540</b> <br/><br/>500G的CDN流量包更是优惠到极致了...</div>'
          ,success: function(layero){
            var btn = layero.find('.layui-layer-btn');
            btn.find('.layui-layer-btn0').attr({
              href: 'https://www.aliyun.com/minisite/goods?userCode=rqxni4zt&share_source=copy_link'
              ,target: '_blank'
            });
          }
        });
    }
  });
</script>-->


<!--分页-->

    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/tags/技术杂谈/page/0/">上一页</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/tags/技术杂谈/page/2/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/tags/技术杂谈/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/tags/技术杂谈/page/2/">2</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/tags/技术杂谈/page/3/">3</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/tags/技术杂谈/page/4/">4</a></li>
            
        </ul>
    </nav>
</div>
</div>
                
                




<!--展示块 布局-->
<div class="column is-4-tablet is-3-desktop is-3-widescreen  has-order-3 column-right ">
    
        <div class="card widget">
  <div class="card-content" style="padding: 0%">
    <!--个人信息-->
    <img src="/images/profile2.png" />
    <!--第三方文章发布平台-->
    <div class="article-platform">
      <span><a href="https://www.jianshu.com/u/092df3f77bca" title="简书" target="_blank"><img src="/images/简书.png"
            width="25" /></a></span>
      <span><a href="https://me.csdn.net/weixin_42033269" title="CSDN" target="_blank"><img src="/images/csdn.svg"
            width="25" /></a></span>
      <span><a href="https://juejin.im/user/5a0aaeecf265da43163c96b7" title="掘金" target="_blank"><img
            src="/images/juejin-logo.svg" width="25" /></a></span>
      <span><a href="https://segmentfault.com/u/hengyushaonian/articles" title="思否" target="_blank"><img
            src="/images/思否.png" width="25" /></a></span>
      <span><a href="https://www.zhihu.com/people/heng-yu-shao-nian/posts" title="知乎" target="_blank"><img
            src="/images/知乎.svg" width="25" /></a></span>
      <span><a href="https://gitee.com/hengboy" title="源码托管平台：码云" target="_blank"><img src="/images/gitee.png"
            width="25" /></a></span>
      <span><a href="https://github.com/hengboy" title="源码托管平台：GitHub" target="_blank"><img src="/images/GitHub.svg"
            width="25" /></a></span>
    </div>
  </div>
</div>
    
        <!--热门文章列表，在文章详情显示，首页不显示-->

    
        


<div class="card widget">
  <div class="card-content" style="padding: 0">
    <a href="/apiboot-all-articles.html" target="_blank">
      <img src="/images/cover/ApiBoot推广封面.png" style="padding: 0px;height: 150px;width:100%" />
    </a>
  </div>
</div>


    
        


<div class="card widget" style="margin-top: 1rem;">

  <div class="card-content" style="padding: 0">

    <a href="http://gk.link/a/10f7u" target="_blank">
      <img src="/images/极客时间199礼包.png" style="padding: 0px;height: 130px;width:100%" />
    </a>

  </div>

</div>


    
        <!--学习专题列表-->


  <div class="card widget" id="topic">
  
  <div class="card-content" style="font-size: 14px;padding-top: 1rem;">
    <ul class="project">
      <li>
        <div class="project-left">
          <img src="/images/spring-boot.svg" width="55" />
        </div>
        <div class="project-right">
          <a href="/spring-boot-1-x-articles.html" target="_blank">
            <p class="title">SpringBoot v1.x 基础教程</p>

            <p class="desc">全网单篇文章阅读量超30万的SpringBoot免费基础教程</p>
          </a>
        </div>
      </li>
    </ul>
  </div>
  <hr>
  
  <div class="card-content" style="font-size: 14px;padding-top: 1rem;">
    <ul class="project">
      <li>
        <div class="project-left">
          <img src="/images/spring-boot.svg" width="55" />
        </div>
        <div class="project-right">
          <a href="/spring-boot-2-x-articles.html" target="_blank">
            <p class="title">SpringBoot v2.x 基础教程</p>

            <p class="desc">持续基于SpringBoot v2.3.x版本更新各个组件的使用以及源码分析</p>
          </a>
        </div>
      </li>
    </ul>
  </div>
  <hr>
  
  <div class="card-content" style="font-size: 14px;padding-top: 1rem;">
    <ul class="project">
      <li>
        <div class="project-left">
          <img src="/images/spring-cloud.svg" width="55" />
        </div>
        <div class="project-right">
          <a href="/spring-cloud-all-articles.html" target="_blank">
            <p class="title">SpringCloud 基础教程</p>

            <p class="desc">全面的涵盖SpringCloud各个组件的免费使用基础教程，持续更新SpringCloud Alibaba系列文章</p>
          </a>
        </div>
      </li>
    </ul>
  </div>
  <hr>
  
  <div class="card-content" style="font-size: 14px;padding-top: 1rem;">
    <ul class="project">
      <li>
        <div class="project-left">
          <img src="/images/api-boot.svg" width="55" />
        </div>
        <div class="project-right">
          <a href="/apiboot-all-articles.html" target="_blank">
            <p class="title">ApiBoot 基础教程</p>

            <p class="desc">新一代的接口服务落地解决方案，提供ApiBoot内的每一个组件的使用系列文章，助力你成为服务架构师.</p>
          </a>
        </div>
      </li>
    </ul>
  </div>
  <hr>
  
  <div class="card-content" style="font-size: 14px;padding-top: 1rem;">
    <ul class="project">
      <li>
        <div class="project-left">
          <img src="/images/技术杂谈.svg" width="55" />
        </div>
        <div class="project-right">
          <a href="/technical-talk.html" target="_blank">
            <p class="title">技术杂谈</p>

            <p class="desc">涵盖Java基础，数据结构与算法，Linux基础使用，代码规范，消息队列基础使用...</p>
          </a>
        </div>
      </li>
    </ul>
  </div>
  <hr>
  
</div>
<script src="/js/lay/modules/jquery.js"></script>
<script>
  var scrollTop = $("#topic").offset().top;
  $(window).scroll(function() {
    if ($(window).scrollTop() > scrollTop) {
      $("#topic").addClass("quoteSticky");
      $("#profile").show();
    } else {
      $("#topic").removeClass("quoteSticky");
      $("#profile").hide();
    }
  });
</script>


    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
  <div class="container">
    <div class="level">
      <div class="level-start has-text-centered-mobile">
        <p class="is-size-7">
          &copy; 2018 - 2022
          恒宇少年 - 于起宇&nbsp;鲁ICP备14029686号
          <br />
          希望每一篇文章都可以给你带来启发，都可以让你不再感到迷茫！
        </p>
      </div>
      <div class="level-end">
        
      </div>
    </div>
  </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>